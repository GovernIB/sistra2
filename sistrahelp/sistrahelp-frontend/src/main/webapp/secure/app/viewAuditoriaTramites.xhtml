<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	template="../layout/mainLayout.xhtml">

	<f:metadata>
		<f:viewAction action="#{viewAuditoriaTramites.init}" />
	</f:metadata>



	<ui:define name="content">
		<h:outputScript library="primefaces-custom" name="calendar_es.js" />
		<h:outputScript library="primefaces-custom" name="calendar_ca.js" />
		<p:importEnum type="es.caib.sistrahelp.frontend.model.types.TypeEvento" var="TypeEvento"/>

		<h:form id="form" styleClass="h100">

			<!-- Growl mensajes -->
			<p:growl id="growl" widgetVar="growl" showDetail="false" life="2000" sticky="false" />

			<!-- Toolbar -->


        	<!-- Si se pone process="panelFiltro" en el commadButton solo se envian los datos de panelFiltro. Si no se pone process se envia todo el formulario. -->
        	<p:panelGrid id="panelFiltro" columns="4" columnClasses="w27,w22,w26,w25" styleClass="noBackground w100 noBorders h10">
        		<h:panelGrid columns="2" styleClass="w100" columnClasses="w25 grid-right,w75">
	        		<p:outputLabel for="filtroIdSesion" value="#{msg['viewAuditoriaTramites.filtroIdSesion']}:"/>
		        	<p:inputText id="filtroIdSesion" value="#{viewAuditoriaTramites.filtros.idSesionTramitacion}" size="30" maxlength="30"/>
	        	</h:panelGrid>
	        	<h:panelGrid columns="2" styleClass="w100" columnClasses="w25 grid-right,w75">
		        	<p:outputLabel for="filtroNif" value="#{msg['viewAuditoriaTramites.filtroNif']}:"/>
		        	<p:inputText id="filtroNif" value="#{viewAuditoriaTramites.filtros.nif}" size="12" maxlength="12"/>
	        	</h:panelGrid>
	        	<h:panelGrid columns="2" styleClass="w100" columnClasses="w35 grid-right,w65">
	        		<p:outputLabel for="filtroTramite" value="#{msg['viewAuditoriaTramites.filtroTramite']}:"/>
	        		<h:panelGroup>
		        		<p:inputText id="filtroTramite" value="#{viewAuditoriaTramites.filtroTramite}" size="16" maxlength="20">
		        			<p:keyFilter regEx="/[a-z0-9_-]/i"/>
		        		</p:inputText>
		        		<p:outputLabel value=" / "/>
		        		<p:inputText id="filtroVersion" value="#{viewAuditoriaTramites.filtroVersion}" size="1" maxlength="2">
		        			<p:keyFilter regEx="/[0-9]/i"/>
		        		</p:inputText>
	        		</h:panelGroup>
	        	</h:panelGrid>
	        	<h:panelGrid columns="2" styleClass="w100" columnClasses="w40 grid-right,w60">
	        		<p:outputLabel for="filtroProcedimiento" value="#{msg['viewAuditoriaTramites.filtroProcedimiento']}:"/>
	        		<p:inputText id="filtroProcedimiento" value="#{viewAuditoriaTramites.filtroProcedimiento}" size="20" maxlength="20"/>
	        	</h:panelGrid>

	        	<h:panelGrid columns="2" styleClass="w100" columnClasses="w25 grid-right,w75">
	        		<p:outputLabel for="filtroFechaInicio" value="#{msg['viewAuditoriaTramites.filtroFechaInicio']}:"/>
	        		<p:calendar id="filtroFechaInicio" value="#{viewAuditoriaTramites.filtros.fechaDesde}" size="15" locale="#{sessionBean.locale}" pattern="dd/MM/yyyy HH:mm:ss" showOn="button" showButtonPanel="true"/>
	        	</h:panelGrid>
	        	<h:panelGrid columns="2" styleClass="w100" columnClasses="w25 grid-right,w75">
	        		<p:outputLabel for="filtroFechaFin" value="#{msg['viewAuditoriaTramites.filtroFechaFin']}:"/>
	        		<p:calendar id="filtroFechaFin" value="#{viewAuditoriaTramites.filtros.fechaHasta}" size="15" locale="#{sessionBean.locale}" pattern="dd/MM/yyyy HH:mm:ss" showOn="button" showButtonPanel="true"/>
	        	</h:panelGrid>
	        	<h:panelGrid columns="2" styleClass="w100" columnClasses="w35 grid-right,w65">
	        		<p:outputLabel for="filtroEvento" value="#{msg['viewAuditoriaTramites.filtroEvento']}:"/>

					<p:selectOneMenu id="filtroEvento" value="#{viewAuditoriaTramites.filtros.evento}" >
					 	<f:selectItem itemLabel="#{msg['selectItem.Todos']}" itemValue="" />
    					 <f:selectItems value="#{TypeEvento.ALL_VALUES}" var="evento" itemLabel="#{msg['typeEvento.' += evento]}"/>
					</p:selectOneMenu >

	        	</h:panelGrid>
          		<p:commandButton icon="fa fa-search" value="#{msg['botones.buscar']}" actionListener="#{viewAuditoriaTramites.filtrar()}" process="panelFiltro" update="dataTable growl" styleClass="boton_derecha"/>

          		</p:panelGrid>


			<!-- Data table -->
			<p:outputPanel  styleClass="h80">
			<p:dataTable  id="dataTable" var="dt" value="#{viewAuditoriaTramites.listaDatos}"
						 rows="10" emptyMessage="#{msg['error.emptyRows']}"
						 scrollable="true" scrollHeight="90%"
                         paginator="true" paginatorPosition="bottom"
                         paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                         rowsPerPageTemplate="5,10,15,30"
			        	 selectionMode="single" selection="#{viewAuditoriaTramites.datoSeleccionado}" rowKey="#{dt.id}">


				<!-- Necesario para actualizar en controlador la fila seleccionada -->
				<p:ajax event="rowSelect" global="false"/>
				<p:ajax event="rowDblselect"
		                  		oncomplete="triggerDblClick();"
		                        update=":form:dataTable"
		                        />

				<!-- Columnas -->
			    <p:column headerText="#{msg['viewAuditoriaTramites.headEvento']}">
			        <h:outputText value="#{dt.tipo}" />
			    </p:column>

			    <p:column headerText="#{msg['viewAuditoriaTramites.headFecha']}">
			        <h:outputText value="#{dt.fecha}">
			        <f:convertDateTime pattern="dd/MM/yyyy HH:mm:ss" type="date" timeZone="CET"/>
			        </h:outputText>
			    </p:column>
			    <p:column headerText="#{msg['viewAuditoriaTramites.headIdSesion']}">
			        <h:outputText value="#{dt.idSesion}" />
			    </p:column>
			    <p:column headerText="#{msg['viewAuditoriaTramites.headNif']}">
			        <h:outputText value="#{dt.nif}" />
			    </p:column>
			    <p:column headerText="#{msg['viewAuditoriaTramites.headTramite']}">
			        <h:outputText value="#{dt.tipo}" />
			    </p:column>
			    <p:column headerText="#{msg['viewAuditoriaTramites.headVersion']}">
			        <h:outputText value="#{dt.tipo}" />
			    </p:column>
			   	<p:column headerText="#{msg['viewAuditoriaTramites.headProcedimiento']}">
			        <h:outputText value="#{dt.tipo}" />
			    </p:column>
			   	<p:column headerText="#{msg['viewAuditoriaTramites.headSIA']}">
			        <h:outputText value="#{dt.tipo}" />
			    </p:column>
			   	<p:column headerText="#{msg['viewAuditoriaTramites.headError']}">
			        <h:outputText value="#{dt.tipo}" />
			    </p:column>
			</p:dataTable></p:outputPanel>

			<h:outputScript >
		      function triggerDblClick() {
		        	$('#form\\:btnEditarHidden').click();
		      }
		    </h:outputScript>
		    <p:commandButton id="btnEditarHidden" value="#{msg['botones.editar']}" icon="fa fa-edit" actionListener="#{viewAuditoriaTramites.rcDobleClick()}" process="@this" update="growl" style="display:none">
       			<p:ajax event="dialogReturn" listener="#{viewAuditoriaTramites.returnDialogo}" update="growl dataTable"/>
       		</p:commandButton>


			<!-- dialogo para confirmar -->
		    <p:confirmDialog global="true" >
				<p:outputPanel styleClass="confirmar_botonera">
		        	<p:commandButton value="#{msg['botones.si']}" type="button" styleClass="ui-confirmdialog-yes boton-azul" icon="fa fa-check"  process="@form"/>
		        	<p:commandButton value="#{msg['botones.no']}" type="button" styleClass="ui-confirmdialog-no" icon="fa fa-close" process="@this"/>
				</p:outputPanel>
		    </p:confirmDialog>

		</h:form>

	</ui:define>

</ui:composition>
