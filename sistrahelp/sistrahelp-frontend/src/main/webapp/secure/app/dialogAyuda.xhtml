<!DOCTYPE html>
<html lang="#{sessionBean.lang}"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui">
<f:view locale="#{sessionBean.locale}" encoding="UTF-8" contentType="text/html">


<h:head>
	<title><h:outputText value="#{msg['dialogAyuda.titulo']}"/></title>
</h:head>

<h:body>
    <f:facet name="last">
    	<h:outputStylesheet library="css" name="style.css" />
    </f:facet>
	<!-- Parametros dialogo -->
	<f:metadata>
		<f:viewParam name="MODO_ACCESO" value="#{dialogAyuda.modoAcceso}"/>
		<f:viewParam name="ID" value="#{dialogAyuda.id}"/>
		<f:viewAction action="#{dialogAyuda.init}" />
	</f:metadata>

	<!-- Growl mensajes -->
	<p:growl id="growlDialogAyuda" widgetVar="growlDialogAyuda" showDetail="false" life="2000" sticky="false" />

	<h:form id="dialogAyuda" >
		 <h:outputScript>
					window.onload=function(){
		let contextMenu =  document.getElementsByClassName('ui-contextmenu')[0];
		onVisible(contextMenu, () => eliminarResaltar());

		document.addEventListener('contextmenu', function(ev) {
			ev.preventDefault();
			getPos();
			return false;
		}, false);
	}

	function eliminarResaltar(){
		let contextMenu =  document.getElementsByClassName('ui-contextmenu')[0];
		let elementos = document.getElementsByClassName('resaltar');
		if(contextMenu!=null &amp;&amp; contextMenu.style.display=='none' &amp;&amp; elementos.length &gt; 0){
			for(let i = 0; i &lt; elementos.length; i++){
				elementos[i].classList.remove('resaltar');
			}
		}
	}

	function onVisible(element, callback) {
	  new IntersectionObserver((entries, observer) => {
		entries.forEach(entry => {
		  if(entry.intersectionRatio == 0) {
			callback(element);
		  }
		});
	  }).observe(element);
	}

	function getPos(){
		var e = window.event;

		var posX = e.clientX;
		var posY = e.clientY;
		var el = document.elementFromPoint(posX, posY);

		let elementos = document.getElementsByClassName('resaltar');
			if(elementos.length &gt; 0){
				for(let i = 0; i &lt; elementos.length; i++){
					elementos[i].classList.remove('resaltar');
				}
			}

		el.classList.add("resaltar");
		var aux = document.getElementById("dialogAyuda:auxCopiar");
		if(el.textContent!='' &amp;&amp; el.textContent!='ui-button'){
			aux.value = el.textContent;
		}else if(el.firstChild!=null &amp;&amp; el.firstChild.value!=undefined){
			aux.value = el.firstChild.value;
		}else if(el.value!=null &amp;&amp; el.value!=''){
			aux.value = el.value;
		}
	}
			</h:outputScript>
		<p:contextMenu onshow="console.log('escondo')">
				<p:menuitem value="#{msg['botones.copiar']}" icon="fa fa-clipboard" styleClass="w100" actionListener="#{dialogAyuda.generarTxt()}"   process="@this :dialogAyuda:auxCopiar" update="growlDialogAyuda"/>
			</p:contextMenu>
			<p:inputText id="auxCopiar" value="#{dialogAyuda.portapapeles}" style="display:none;"/>
			<!-- Workpanel: Iframe HTML -->
			<p:outputPanel id="formulario-panel" styleClass="w100 h100">
				<iframe id="formulario-frame" name="formulario-frame" src="#{dialogAyuda.urlIframe}" class="ayuda-frame">
				  <p>Tu navegador no soporta iframes.</p>
				</iframe>
			 </p:outputPanel>

		<!-- Botonera abajo -->

		<p:outputPanel styleClass="botonera" id="botonera">
			<p:toolbar>
				<f:facet name="right">
					<p:outputPanel styleClass="confirmar_botonera">
						<p:commandButton value="#{msg['botones.cerrar']}" actionListener="#{dialogAyuda.cancelar}" process="@this"/>
					</p:outputPanel>
				</f:facet>
			</p:toolbar>
		</p:outputPanel>

	</h:form>


</h:body>

</f:view>
</html>
