<!DOCTYPE html>
<html lang="#{sessionBean.lang}"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui">

<f:view locale="#{sessionBean.locale}" encoding="UTF-8" contentType="text/html">

<h:head>
	<title><h:outputText value="#{msg['botones.stg']}"/></title>
	<h:outputScript library="js" name="encode.js"/>
	<script type="text/javascript">

		function comprobarError(){
			let action = document.getElementById('formulario-frame').contentWindow.document.getElementsByTagName('form')[0].getAttribute('action')
			if(action == '/sistragesback/error/errorException.xhtml'){
				document.getElementById("dialogDefinicionVersion:msg").value=document.getElementById("dialogDefinicionVersion:msg").value= document.getElementById('formulario-frame').contentWindow.document.getElementsByClassName('error_panel3')[1].getElementsByTagName('label')[1].innerText;
				document.getElementById("dialogDefinicionVersion:cerrar").click();
			}
		}

	</script>
</h:head>

<h:body>
  <f:facet name="last">
    <h:outputStylesheet library="css" name="style.css" />
  </f:facet>

	<!-- Parametros dialogo -->
	<f:metadata>
		<f:viewParam name="TRAMITE" value="#{dialogDefinicionVersion.tramite}"/>
		<f:viewParam name="VERSION" value="#{dialogDefinicionVersion.version}"/>

		<f:viewAction action="#{dialogDefinicionVersion.init}" />
	</f:metadata>
	<h:form id="dialogDefinicionVersion" styleClass="w100 h100">
		<p:commandButton id="cerrar" action="#{dialogDefinicionVersion.closeDialog()}" process="@this @form:msg" style="display:none;"/>
		<p:inputText id="msg" value="#{dialogDefinicionVersion.mensaje}" style="display:none;" onblur="this.value = this.value.trim();"/>
  		<p:outputPanel styleClass="w100 h100">
  			<!-- Workpanel: Iframe HTML -->
			<p:outputPanel id="formulario-panel" styleClass="w100 h100">
				<iframe id="formulario-frame" name="formulario-frame" class="ayuda-frame" onload="comprobarError();" src="#{dialogDefinicionVersion.url}" styleClass="w100" style="height:calc(100vh - 38px);">
				  <p>Tu navegador no soporta iframes.</p>
				</iframe>
			 </p:outputPanel>

		</p:outputPanel>

		<p:outputPanel styleClass="botonera" id="botonera">
			<p:toolbar>
				<f:facet name="right">
					<p:outputPanel styleClass="confirmar_botonera">
						<p:commandButton value="#{msg['botones.cerrar']}" actionListener="#{dialogDefinicionVersion.cancelar}" process="@this"/>
					</p:outputPanel>
				</f:facet>
			</p:toolbar>
		</p:outputPanel>
	</h:form>

</h:body>
</f:view>

</html>
