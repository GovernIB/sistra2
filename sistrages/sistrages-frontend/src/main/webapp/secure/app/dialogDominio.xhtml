<!DOCTYPE html>
<html lang="#{sessionBean.lang}"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui">

<f:view locale="#{sessionBean.locale}" encoding="UTF-8" contentType="text/html">

<p:importEnum type="es.caib.sistrages.core.api.model.types.TypeDominio" var="TypeDominio"/>

<h:head>
	<title><h:outputText value="#{msg['dialogDominio.titulo']}"/></title>

  <f:facet name="last">
    <h:outputStylesheet library="css" name="style.css" />
  </f:facet>
</h:head>

<h:body>

	<!-- Parametros dialogo -->
	<f:metadata>
		<f:viewParam name="MODO_ACCESO" value="#{dialogDominio.modoAcceso}"/>
		<f:viewParam name="ID" value="#{dialogDominio.id}"/>
		<f:viewAction action="#{dialogDominio.init}" />
	</f:metadata>
	<h:form id="dialogDominio" styleClass="margin-top-10">
  			<p:outputPanel>
				<!-- Contenido dialogo -->
				<!-- Growl mensajes -->
				<p:growl id="growlDialog" widgetVar="growlDialog" life="2000" sticky="false" />


			<h:panelGrid rowClasses=", ui-datatable-odd" columnClasses="padding-left-18," columns = "2" cellpadding = "5" cellspacing = "0"  width="100%">

				<p:outputLabel for="codigo" value="#{msg['dialogDominio.headerCodigo']}" />
				<p:inputText id="codigo" value="#{dialogDominio.data.codigo}" disabled="#{!dialogDominio.isAlta()}" required="true"/>

				<p:outputLabel for="descripcion" value="#{msg['dialogDominio.headerDescripcion']}" />
				<p:inputTextarea id="descripcion" value="#{dialogDominio.data.descripcion}" disabled="#{dialogDominio.isConsulta()}" required="true" rows="4" cols="40" style="width:95%" />

				<p:outputLabel for="cacheo" value="#{msg['dialogDominio.headerCachear']}" />
				<p:selectBooleanCheckbox id="cacheo" value="#{dialogDominio.data.cacheable}" itemLabel="#{msg['dialogDominio.headerCachearCheck']}" />

				<p:column>
			    	<p style="width:230px">
			    		<p:outputLabel  value="#{msg['dialogDominio.headerTipo']}:" />
					</p>
					<p:selectOneMenu id="tipo" layout="pageDirection" value="#{dialogDominio.data.tipo}" style="width:200px" required="true">
					     <f:selectItems value="#{TypeDominio.ALL_VALUES}" var="tipo" itemLabel="#{msg['typeDominio.' += tipo]}" itemValue="#{tipo}" />
						<p:ajax event="change" listener="#{dialogDominio.actualizarTipo()}" process="@this" update="@form columnaBBDD1 columnaBBDD2 columnaLista1 columnaLista2 columnaRemota columnaFuente1 columnaFuente2" />
					</p:selectOneMenu >


				</p:column>
				<h:panelGrid columnClasses=",wpx25" columns = "2" cellpadding = "5" cellspacing = "0"  width="100%">

						<p:column id="columnaBBDD1" colspan="1" rendered="#{dialogDominio.visibleJNDI}" >
							<p:outputLabel for="jndi" value="#{msg['dialogDominio.headerTipo.consultaBD.jndi']}" style="margin-right:20px" />
							<p:inputText id="jndi" value="#{dialogDominio.data.jndi}" disabled="#{dialogDominio.isConsulta()}" size="30"  />
						</p:column>
						<p:outputLabel rendered="#{dialogDominio.visibleJNDI}"  value="" />

						<p:column id="columnaBBDD2" colspan="1" rendered="#{dialogDominio.visibleJNDI}" >
							<p:outputLabel for="sql" value="#{msg['dialogDominio.headerTipo.consultaBD.query']}" style="margin-right:20px"  />
							<p:inputTextarea id="sql" value="#{dialogDominio.data.sql}" disabled="#{dialogDominio.isConsulta()}" rows="4" cols="40" />
						</p:column>
						<p:outputLabel rendered="#{dialogDominio.visibleJNDI}"  value="" />

						<p:column id="columnaLista1" colspan="2" rendered="#{dialogDominio.visibleLista}">

							<!-- Data table -->
							<p:dataTable  id="datalistValores"
										 var="td"
										 value="#{dialogDominio.listaValores}"
										 scrollable="true"
										 scrollHeight="140"
										 paginator="false"
										 selectionMode="single"
										 selection="#{dialogDominio.valorSeleccionado}"
										 rowKey="#{td.codigo}"
										 dblClickSelect="true">

								<!--  Doble click (selecciona fila y llama al finalizar al click del boton editar -->
								<p:ajax event="rowDblselect" oncomplete="rcEditarValor();"/>

								<!-- Necesario para actualizar en controlador la fila seleccionada -->
								<p:ajax event="rowSelect" />
								<p:ajax event="rowUnselect" />

								<!-- Columnas -->
								<p:column headerText="#{msg['dialogDominio.headerParametros.codigo']}" class="ui-panelgrid-cell">
									<h:outputText value="#{td.codigo}" />
							    </p:column>

							    <p:column headerText="#{msg['dialogDominio.headerParametros.valor']}" class="ui-panelgrid-cell">
							        <h:outputText value="#{td.valor}" />
							    </p:column>
				 			</p:dataTable>
						</p:column>
						<p:column id="columnaLista2"  rendered="#{dialogDominio.visibleLista}">
								<p>
									<p:commandButton id="btnNuevoValor" icon="fa fa-plus" actionListener="#{dialogDominio.nuevoValor()}" process="@this" update="growlDialog"  >
		        						<p:ajax event="dialogReturn" listener="#{dialogDominio.returnDialogo}" update="growlDialog datalistValores"/>
		        					</p:commandButton>
		        				</p>
		        				<p>
		        					<p:commandButton id="btnEditarValor" icon="fa fa-edit" actionListener="#{dialogDominio.editarValor()}" process="@this" update="growlDialog"  >
		        						<p:ajax event="dialogReturn" listener="#{dialogDominio.returnDialogo}" update="growlDialog datalistValores"/>
		        					</p:commandButton>
		        				</p>
							    <p>
							    	<p:commandButton id="btnEliminarValor" icon="fa fa-minus" actionListener="#{dialogDominio.quitarValor()}" process="@this" update="growlDialog datalistValores"   />
							    </p>
							    <p>
						    		<p:commandButton icon="fa fa-arrow-up" actionListener="#{dialogDominio.subirValor()}" process="@this" update="growlDialog datalistValores" />
						    	</p>
						    	<p>
						    		<p:commandButton icon="fa fa-arrow-down" actionListener="#{dialogDominio.bajarValor()}" process="@this" update="growlDialog datalistValores" />
						    	</p>
						</p:column>

						<p:column id="columnaRemota" rendered="#{dialogDominio.visibleRemoto}">
							<p>
								<p:outputLabel for="urlRemoto" value="#{msg['dialogDominio.headerTipo.consultaRemota.url']}"  />
							</p>
							<p>
								<p:inputText id="urlRemoto" value="#{dialogDominio.data.url}" disabled="#{dialogDominio.isConsulta()}" size="40"  />
							</p>
						</p:column>
						<p:outputLabel rendered="#{dialogDominio.visibleRemoto}" value=""  />

						<p:column id="columnaFuente1" colspan="1" rendered="#{dialogDominio.visibleFuente}" >
							<p:outputLabel for="fuente" value="#{msg['dialogDominio.headerTipo.fuente.fuente']}" style="margin-right:20px" />
							<p:selectOneMenu id="fuente" value="#{dialogDominio.data.fuenteDatos}" style="width:200px">
							    <f:selectItems value="#{dialogDominio.fuentes}" var="fd"
		    							itemValue="#{fd}" itemLabel="#{fd.codigo}" />
							</p:selectOneMenu >
						</p:column>
						<p:outputLabel rendered="#{dialogDominio.visibleFuente}"  value="" />

						<p:column id="columnaFuente2" colspan="1" rendered="#{dialogDominio.visibleFuente}" >
							<p:outputLabel for="fuenteQuery" value="#{msg['dialogDominio.headerTipo.fuente.query']}" style="margin-right:20px"  />
							<p:inputTextarea id="fuenteQuery" value="#{dialogDominio.data.fuenteDatosQuery}" disabled="#{dialogDominio.isConsulta()}" rows="4" cols="40" />
						</p:column>
						<p:outputLabel rendered="#{dialogDominio.visibleFuente}"  value="" />
				</h:panelGrid>

				<p:outputLabel for="dataTableParametros" value="#{msg['dialogDominio.headerParametros.titulo']}" />
				<h:panelGrid columnClasses=",wpx25" columns = "2" cellpadding = "5" cellspacing = "0"  width="100%">

					<p:dataTable  id="dataTableParametros"
									 var="td"
									 value="#{dialogDominio.propiedades}"
									 scrollable="true"
									 scrollHeight="140"
									 selectionMode="single"
									 selection="#{dialogDominio.propiedadSeleccionada}"
									 rowKey="#{td.codigo}"
									 dblClickSelect="true">

							<!--  Doble click (selecciona fila y llama al finalizar al click del boton editar -->
							<p:ajax event="rowDblselect" oncomplete="rcEditarPropiedad();"/>

							<!-- Necesario para actualizar en controlador la fila seleccionada -->
							<p:ajax event="rowSelect" />
							<p:ajax event="rowUnselect" />

							<!-- Columnas -->
							<p:column headerText="#{msg['dialogDominio.headerParametros.orden']}" class="ui-panelgrid-cell">
						        <h:outputText value="#{td.orden}" />
						    </p:column>

							<p:column headerText="#{msg['dialogDominio.headerParametros.codigo']}" class="ui-panelgrid-cell">
								<h:outputText value="#{td.codigo}" />
						    </p:column>


			 		</p:dataTable>
			 		<p:column>
						<p>
				    		<p:commandButton id="btnNuevaPropiedad" icon="fa fa-plus" actionListener="#{dialogDominio.nuevaPropiedad()}" process="@this" update="growlDialog">
	       						<p:ajax event="dialogReturn" listener="#{dialogDominio.returnDialogo}" update="growlDialog dataTableParametros"/>
	       					</p:commandButton>
	       				</p>
	       				<p>
				    		<p:commandButton id="btnEditarPropiedad" icon="fa fa-edit" actionListener="#{dialogDominio.editarPropiedad()}" process="@this" update="growlDialog">
	       						<p:ajax event="dialogReturn" listener="#{dialogDominio.returnDialogo}" update="growlDialog dataTableParametros"/>
	       					</p:commandButton>
	       				</p>
						<p>
				    		<p:commandButton id="btnEliminarPropiedad" icon="fa fa-minus" actionListener="#{dialogDominio.quitarPropiedad()}" process="@this" update="growlDialog dataTableParametros" />
				    	</p>
				    	<p>
				    		<p:commandButton icon="fa fa-arrow-up" actionListener="#{dialogDominio.subirPropiedad()}" process="@this" update="growlDialog dataTableParametros" />
				    	</p>
				    	<p>
				    		<p:commandButton icon="fa fa-arrow-down" actionListener="#{dialogDominio.bajarPropiedad()}" process="@this" update="growlDialog dataTableParametros" />
				    	</p>
					</p:column>
		 		</h:panelGrid>
			</h:panelGrid>

			<h:outputScript>
		      function rcEditarPropiedad() {
		        document.getElementById("form:btnEditarPropiedad").click();
		      }
		      function rcEditarValor() {
		        document.getElementById("form:btnEditarValor").click();
		      }
		      function  rcBorrarPropiedad() {
		        document.getElementById("form:btnEliminarPropiedad").click();
		      }
		      function  rcBorrarValor() {
		        document.getElementById("form:btnEliminarValor").click();
		      }
		    </h:outputScript>
			</p:outputPanel>
		  	 <p:outputPanel styleClass="botonera">
		     	<p:toolbar>
					<f:facet name="right">
		        		<p:commandButton value="#{msg['botones.aceptar']}" actionListener="#{dialogDominio.aceptar()}" process="@form" update="@form growlDialog"  styleClass="boton-azul" />
						<p:commandButton value="#{msg['botones.cancelar']}" actionListener="#{dialogDominio.cancelar()}" process="@this"/>
					</f:facet>
				</p:toolbar>
		    </p:outputPanel>
	</h:form>
</h:body>

</f:view>
</html>
