<!DOCTYPE html>
<html lang="#{sessionBean.lang}"
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:f="http://java.sun.com/jsf/core"
  xmlns:h="http://java.sun.com/jsf/html"
  xmlns:ui="http://java.sun.com/jsf/facelets"
  xmlns:pe="http://primefaces.org/ui/extensions"
  xmlns:p="http://primefaces.org/ui">

<f:view locale="#{sessionBean.locale}" encoding="UTF-8" contentType="text/html">
<p:importEnum type="es.caib.sistrages.core.api.model.types.TypeFormularioObligatoriedad" var="TypeFormularioObligatoriedad" />
<p:importEnum type="es.caib.sistrages.core.api.model.types.TypeScriptFlujo" var="TypeScriptFlujo" />
<p:importEnum type="es.caib.sistrages.core.api.model.types.TypeFormularioGestor" var="TypeFormularioGestor"/>

<h:head>
  <title><h:outputText value="#{msg['dialogDefinicionVersionFormulario.titulo']}"/></title>
</h:head>

<h:body>
  <f:facet name="last">
    <h:outputStylesheet library="css" name="style.css" />
  </f:facet>

  <!-- Parametros dialogo -->
  <f:metadata>
    <f:viewParam name="MODO_ACCESO" value="#{dialogDefinicionVersionFormulario.modoAcceso}"/>
    <f:viewParam name="ID" value="#{dialogDefinicionVersionFormulario.id}" />
    <f:viewParam name="TRAMITEVERSION" value="#{dialogDefinicionVersionFormulario.idTramiteVersion}" />
    <f:viewParam name="TRAMITEPASO" value="#{dialogDefinicionVersionFormulario.idPaso}" />
    <f:viewParam name="AREA" value="#{dialogDefinicionVersionFormulario.area}" />
    <f:viewAction action="#{dialogDefinicionVersionFormulario.init}" />
  </f:metadata>

  <p:importEnum type="es.caib.sistrages.core.api.model.types.TypeFormularioObligatoriedad" var="TypeFormularioObligatoriedad" />


  <h:form id="formDialogDefinicionVersionFormulario" styleClass="h100, margin-top-10">
	<h:outputScript >
	  var arrayCm = [];
					
				  window.onload=function(){
	    let contextMenu =  document.getElementsByClassName('ui-contextmenu')[0];
		onVisible(contextMenu, () => eliminarResaltar());

		document.addEventListener('contextmenu', function(ev) {
	    	ev.preventDefault();
	    	getPos();
	    	return false;
		}, false);
	  }

		function eliminarResaltar(){
			let contextMenu =  document.getElementsByClassName('ui-contextmenu')[0];
	  		let elementos = document.getElementsByClassName('resaltar');
	  		if(contextMenu!=null &amp;&amp; contextMenu.style.display=='none' &amp;&amp; elementos.length &gt; 0){
				for(let i = 0; i &lt; elementos.length; i++){
					elementos[i].classList.remove('resaltar');
				}
	  		}
		}

		function onVisible(element, callback) {
		  new IntersectionObserver((entries, observer) => {
		    entries.forEach(entry => {
		      if(entry.intersectionRatio == 0) {
		        callback(element);
		      }
		    });
		  }).observe(element);
		}

	  function getPos(){
	 	var e = window.event;

	    var posX = e.clientX;
	    var posY = e.clientY;
	    var el = document.elementFromPoint(posX, posY);

	    let elementos = document.getElementsByClassName('resaltar');
	  		if(elementos.length &gt; 0){
				for(let i = 0; i &lt; elementos.length; i++){
					elementos[i].classList.remove('resaltar');
				}
	  		}

		el.classList.add("resaltar");
		var aux = document.getElementById("formDialogDefinicionVersionFormulario:auxCopiar");
		if(el.textContent!='' &amp;&amp; el.textContent!='ui-button'){
			aux.value = el.textContent;
		}else if(el.firstChild!=null &amp;&amp; el.firstChild.value!=undefined){
			aux.value = el.firstChild.value;
		}else if(el.value!=null &amp;&amp; el.value!=''){
			aux.value = el.value;
		}else{
          aux.value = '';
        }

		  if(aux.value!='' ){
            var multiple = false;
            var hijos = el.children;
			if((el.tagName == 'UL' || el.tagName == 'TABLE' || el.tagName == 'TR') &amp;&amp; hijos.length &gt; 1){
		            multiple = true;
		                  }else if(hijos.length &gt;= 1 ){
		                  	if(hijos.length==1  &amp;&amp; hijos[0].tagName=='DIV'){
		                  		hijos = hijos[0].children;
		                  	}
			                    for(i=0;i&lt;hijos.length;i++){
					              if(hijos[i].tagName!='SPAN' &amp;&amp; hijos[i].tagName!='LABEL'){
					                multiple=true;
					              }
			                    }

		                  }
                  var listaCm = document.getElementsByClassName('ui-contextmenu');
                  if(multiple){
                    for(i=0;i&lt;listaCm.length;i++){
                    	if(listaCm[i].style.display=='block'  &amp;&amp; !arrayCm.includes(listaCm[i])){
                    		arrayCm.push(listaCm[i]);
                    	}
	                	listaCm[i].classList.add("d-none");
					}
                  }else{
                  	for(i=0;i&lt;listaCm.length;i++){
                  		if(listaCm[i].style.display=='block'  &amp;&amp; !arrayCm.includes(listaCm[i])){
                    		arrayCm.push(listaCm[i]);
                    	}
	                	listaCm[i].classList.remove("d-none");
					}
					if(arrayCm.length&gt;1){
						arrayCm.pop();
						for(let i=0; i&lt;arrayCm.length; i++){
							arrayCm[i].style.display='none';
						}
					}
					arrayCm = [];
                  }

               }
	 }

	</h:outputScript>

	<!-- Growl mensajes -->
    <p:growl id="growl" widgetVar="growl" life="#{sessionBean.growlLife}" sticky="#{sessionBean.growlSticky}" />

	<p:outputPanel>


    <h:panelGrid rowClasses=", ui-datatable-odd" columns="2" columnClasses="w10 padding-left-18, w90 grid-left" styleClass="w100 h100" cellpadding = "5" cellspacing = "0">

            <p:outputLabel for="identificador" value="#{msg['dialogDefinicionVersionFormulario.identificador']}" />
            <p:inputText id="identificador" required="true" styleClass="w25" maxlength="20" value="#{dialogDefinicionVersionFormulario.data.identificador}" onblur="this.value = this.value.toUpperCase();" validatorMessage="#{msg['error.validacion.identificador']}">
				<p:keyFilter regEx="/[a-z0-9_-]/i" preventPaste="false"/>
				<f:validateRegex pattern="^[a-zA-Z0-9_-]{1,20}$" />
				<p:ajax event="change" listener="#{dialogDefinicionVersionFormulario.setCambios}"/>
	        </p:inputText>

            <p:outputLabel for="descripcion" value="#{msg['dialogDefinicionVersionFormulario.descripcion']}" />
            <p:outputPanel styleClass="ui-inputgroup">
               <p:inputText id="descripcion" required="true" readonly="true" styleClass="w85" value="#{dialogDefinicionVersionFormulario.data.descripcion.getTraduccion(sessionBean.lang,dialogDefinicionVersionFormulario.idiomas)}" />
               <p:commandButton icon="fa fa-language" actionListener="#{dialogDefinicionVersionFormulario.editarDescripcion()}"	process="@this" update="growl">
                 <p:ajax event="dialogReturn" listener="#{dialogDefinicionVersionFormulario.returnDialogo}" update="growl descripcion" />
            </p:commandButton>
           </p:outputPanel>

           <p:outputLabel value="#{msg['dialogDefinicionVersionFormulario.obligatoriedad']}" />
           <p:panelGrid styleClass="noBorders">
               <p:row>
                 <p:column styleClass="noPadding-left">
                 <p:selectOneRadio id="obligatoriedad" value="#{dialogDefinicionVersionFormulario.data.obligatoriedad}">
                   <f:selectItems value="#{TypeFormularioObligatoriedad.ALL_VALUES}" var="tipo" itemLabel="#{msg['typeFormularioObligatoriedad.' += tipo]}" />
                   <p:ajax event="change" listener="#{dialogDefinicionVersionFormulario.setCambios}" process="@this" update="@this"/>
	              </p:selectOneRadio>
	             </p:column>
	             <p:column>
		               <p:commandButton id="scriptObligatoriedad" icon="fa fa-bolt" actionListener="#{dialogDefinicionVersionFormulario.script(TypeScriptFlujo.SCRIPT_DEPENDENCIA_DOCUMENTO.name(), dialogDefinicionVersionFormulario.data.scriptObligatoriedad)}" value="#{msg['script.SCRIPT_DEPENDENCIA_DOCUMENTO.titulo']}"
		              			styleClass="#{viewDefinicionVersion.getColorScript(dialogDefinicionVersionFormulario.data.scriptObligatoriedad)}"
		                      process="@this" update="growl">
		              <p:ajax event="dialogReturn" listener="#{dialogDefinicionVersionFormulario.returnDialogoObligatoriedad}" update="growl scriptObligatoriedad" />
		            </p:commandButton>
		          </p:column>
		        </p:row>
           </p:panelGrid>

           <p:outputLabel value="#{msg['dialogDefinicionVersionFormulario.presentacionelectronica']}" />
           <p:panelGrid styleClass="noBorders">
               <p:row>
                 <p:column styleClass="noPadding-left">
            <p:selectBooleanCheckbox id="firmardigitalmente" value="#{dialogDefinicionVersionFormulario.data.debeFirmarse}" itemLabel="#{msg['dialogDefinicionVersionFormulario.firmardigitalmente']}">
            	<p:ajax event="change" listener="#{dialogDefinicionVersionFormulario.setCambios}" process="@this" update="@this"/>
            </p:selectBooleanCheckbox>
             </p:column>
             <p:column>
               <p:commandButton id="scriptFirma" icon="fa fa-bolt" actionListener="#{dialogDefinicionVersionFormulario.script(TypeScriptFlujo.SCRIPT_FIRMANTES.name(), dialogDefinicionVersionFormulario.data.scriptFirma)}" value="#{msg['script.SCRIPT_FIRMANTES.titulo']}"
              styleClass="#{viewDefinicionVersion.getColorScript(dialogDefinicionVersionFormulario.data.scriptFirma)}"
                      process="@this" update="growl">
		                      <p:ajax event="dialogReturn" listener="#{dialogDefinicionVersionFormulario.returnDialogoFirma}" update="growl scriptFirma" />
		            </p:commandButton>
		          </p:column>
		        </p:row>
           </p:panelGrid>

	      <p:outputLabel value="#{msg['dialogDefinicionVersionFormulario.scriptpersonalizacion']}" />
	           <p:panelGrid styleClass="noBorders">
	               <p:row>
		                <p:column styleClass="noPadding-left">
			            	 <p:commandButton id="scriptDatosIniciales" icon="fa fa-bolt" actionListener="#{dialogDefinicionVersionFormulario.script(TypeScriptFlujo.SCRIPT_DATOS_INICIALES_FORMULARIO.name(), dialogDefinicionVersionFormulario.data.scriptDatosIniciales)}" value="#{msg['script.SCRIPT_DATOS_INICIALES_FORMULARIO.titulo']}"
			              			styleClass="#{viewDefinicionVersion.getColorScript(dialogDefinicionVersionFormulario.data.scriptDatosIniciales)}"
			                      process="@this" update="growl">
			                      <p:ajax event="dialogReturn" listener="#{dialogDefinicionVersionFormulario.returnDialogoDatosIniciales}" update="growl scriptDatosIniciales" />
			           		 </p:commandButton>
		          		</p:column>
	        		</p:row>
	        		<p:row>
			             <p:column styleClass="noPadding-left">
			              <p:commandButton id="scriptParametros" icon="fa fa-bolt" actionListener="#{dialogDefinicionVersionFormulario.script(TypeScriptFlujo.SCRIPT_PARAMETROS_FORMULARIO.name(), dialogDefinicionVersionFormulario.data.scriptParametros)}" value="#{msg['script.SCRIPT_PARAMETROS_FORMULARIO.titulo']}"
			              			styleClass="#{viewDefinicionVersion.getColorScript(dialogDefinicionVersionFormulario.data.scriptParametros)}"
			                      	process="@this" update="growl">
			                      <p:ajax event="dialogReturn" listener="#{dialogDefinicionVersionFormulario.returnDialogoParametros}" update="growl scriptParametros" />
			            </p:commandButton>
			          </p:column>
			        </p:row>
			        <p:row>
			             <p:column styleClass="noPadding-left">
			               <p:commandButton id="scriptRetorno" icon="fa fa-bolt" actionListener="#{dialogDefinicionVersionFormulario.script(TypeScriptFlujo.SCRIPT_POSTGUARDAR_FORMULARIO.name(), dialogDefinicionVersionFormulario.data.scriptRetorno)}" value="#{msg['script.SCRIPT_POSTGUARDAR_FORMULARIO.titulo']}"
			              				styleClass="#{viewDefinicionVersion.getColorScript(dialogDefinicionVersionFormulario.data.scriptRetorno)}"
			             				process="@this" update="growl">
			              <p:ajax event="dialogReturn" listener="#{dialogDefinicionVersionFormulario.returnDialogoRetorno}" update="growl scriptRetorno" />
			            </p:commandButton>
			          </p:column>
			        </p:row>
	      	</p:panelGrid>

	      	<p:outputLabel value="#{msg['dialogDefinicionVersionFormulario.disenyoformulario']}" rendered="#{dialogDefinicionVersionFormulario.data.tipoFormulario == TypeFormularioGestor.INTERNO}" />
	      	<p:commandButton actionListener="#{dialogDefinicionVersionFormulario.editarDisenyo}" value="#{msg['dialogDefinicionVersionFormulario.disenyoformulario.editardisenyo']}"  rendered="#{dialogDefinicionVersionFormulario.data.tipoFormulario == TypeFormularioGestor.INTERNO}"
	              process="@this" update="growl"/>


			<p:outputLabel for="gestorFormularioExterno" value="#{msg['dialogDefinicionVersionFormulario.gestorFormularioExterno']}*" rendered="#{dialogDefinicionVersionFormulario.data.tipoFormulario == TypeFormularioGestor.EXTERNO}" />
			<p:selectOneMenu id="gestorFormularioExterno" value="#{dialogDefinicionVersionFormulario.data.formularioGestorExterno}" required="true"  converter="#{gestorConverter}"  rendered="#{dialogDefinicionVersionFormulario.data.tipoFormulario == TypeFormularioGestor.EXTERNO}">
    					 <f:selectItems value="#{dialogDefinicionVersionFormulario.gestores}" var="gestor" itemLabel="#{gestor.identificador}" itemValue="#{gestor}" />
    					 <p:ajax event="change" listener="#{dialogDefinicionVersionFormulario.setCambios}" process="@this" update="@this"/>
			</p:selectOneMenu >

            <p:outputLabel for="identificadorExt" value="#{msg['dialogDefinicionVersionFormulario.gestorFormularioExternoIDFormulario']}" rendered="#{dialogDefinicionVersionFormulario.data.tipoFormulario == TypeFormularioGestor.EXTERNO}"/>
            <p:inputText id="identificadorExt"  styleClass="w25" value="#{dialogDefinicionVersionFormulario.data.idFormularioExterno}"  required="true" rendered="#{dialogDefinicionVersionFormulario.data.tipoFormulario == TypeFormularioGestor.EXTERNO}"/>




   	 </h:panelGrid>
     </p:outputPanel>
	 <p:outputPanel styleClass="botonera">
	     	<p:toolbar>
				<f:facet name="right">
	        		<p:commandButton value="#{msg['botones.guardar']}" actionListener="#{dialogDefinicionVersionFormulario.aceptar()}" process="@form" update="@form growl"  styleClass="boton-azul"/>
					<p:commandButton value="#{msg['botones.cancelar']}" actionListener="#{dialogDefinicionVersionFormulario.cancelar()}" process="@this" />
					<p:commandButton id="btnHelp" value="#{msg['botones.ayuda']}" icon="fa fa-question-circle-o" actionListener="#{dialogDefinicionVersionFormulario.ayuda()}" process="@this"/>
				</f:facet>
			</p:toolbar>
	 </p:outputPanel>
	 <p:contextMenu>
       			<p:menuitem value="#{msg['botones.copiar']}" icon="fa fa-clipboard" styleClass="w90" id="mnuCopy"  process="@this :formDialogDefinicionVersionFormulario:auxCopiar" update="growl" />
		    </p:contextMenu>
		    <pe:clipboard id="clipContextCopy" trigger="mnuCopy" action="copy" target="auxCopiar">
				<p:ajax event="success" listener="#{dialogDefinicionVersionFormulario.copiadoCorr}" process="@this" update="@this growl"/>
            	<p:ajax event="error" listener="#{dialogDefinicionVersionFormulario.copiadoErr}" update="@this growl"/>
        	</pe:clipboard>

		    <p:inputText id="auxCopiar" value="#{dialogDefinicionVersionFormulario.portapapeles}" style="padding:0px; opacity:0; width: 1px; height:1px; cursor:default;"/>
  </h:form>

</h:body>

</f:view>
</html>
