<!DOCTYPE html>
<html lang="#{sessionBean.lang}"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui">

<f:view locale="#{sessionBean.locale}" encoding="UTF-8" contentType="text/html">
<p:importConstants type="es.caib.sistrages.core.api.model.comun.ConstantesDisenyo" var="Constantes" />


<h:head>
	<title><h:outputText value="#{msg['dialogDisenyoFormulario.titulo']}"/></title>
</h:head>

<h:body>
    <f:facet name="last">
    	<h:outputStylesheet library="css" name="style.css" />
    </f:facet>
	<!-- Parametros dialogo -->
	<f:metadata>
		<f:viewParam name="MODO_ACCESO" value="#{dialogDisenyoFormulario.modoAcceso}"/>
		<f:viewParam name="ID" value="#{dialogDisenyoFormulario.id}"/>
		<f:viewParam name="TRAMITEVERSION" value="#{dialogDisenyoFormulario.idTramiteVersion}"/>
		<f:viewAction action="#{dialogDisenyoFormulario.init}" />
	</f:metadata>

	<!-- Growl mensajes -->
	<p:growl id="growlDisenyoFormulario" widgetVar="growlDisenyoFormulario" showDetail="false" life="2000" sticky="false" />

	<h:form id="dialogDisenyoFormulario" >
		<!--  Toolbar -->
		<p:toolbar>
			<p:toolbarGroup align="left">

				<p:commandButton id="btnFormulario" value="#{msg['dialogDisenyoFormulario.formulario']}" icon="fa fa-file-text-o" actionListener="#{dialogDisenyoFormulario.abrirPropiedadesFormulario}" process="@this" update="growlDisenyoFormulario" title="#{msg['dialogDisenyoFormulario.title.formulario']}">
					<p:ajax event="dialogReturn" listener="#{dialogDisenyoFormulario.returnDialogo}" oncomplete="if (!args.validationFailed) {updateUI();}" update="growlDisenyoFormulario"/>
				</p:commandButton>

				<h:panelGroup class="ui-separator margin-right-10" rendered="#{dialogDisenyoFormulario.isNotConsulta()}">
                	<span class="ui-icon ui-icon-grip-dotted-vertical" />
           		</h:panelGroup>

				<h:panelGroup class="barra-herramientas-disenyo" rendered="#{dialogDisenyoFormulario.isNotConsulta()}">
					<p:outputLabel value="#{msg['dialogDisenyoFormulario.componente']}"/>
					<p:commandButton id="btnLinea" 		    title="#{msg['dialogDisenyoFormulario.componente.LN']}" icon="fa fa-ellipsis-h" actionListener="#{dialogDisenyoFormulario.insertaLinea}" process="@form" oncomplete="if (!args.validationFailed) {updateUI();}" update="growlDisenyoFormulario"/>
		       		<p:commandButton id="btnSeccion" 		title="#{msg['dialogDisenyoFormulario.componente.SC']}" icon="fa fa-list-ul" actionListener="#{dialogDisenyoFormulario.insertaSeccion}" process="@form" oncomplete="if (!args.validationFailed) {updateUI();}" update="growlDisenyoFormulario"/>
		       		<p:commandButton id="btnEtiqueta" 		title="#{msg['dialogDisenyoFormulario.componente.ET']}" icon="fa fa-commenting-o" actionListener="#{dialogDisenyoFormulario.insertaEtiqueta}" process="@form" oncomplete="if (!args.validationFailed) {updateUI();}" update="growlDisenyoFormulario"/>
		       		<p:commandButton id="btnCampoTexto" 	title="#{msg['dialogDisenyoFormulario.componente.CT']}" icon="fa fa-pencil-square-o" actionListener="#{dialogDisenyoFormulario.insertaCampoTexto}" process="@form" oncomplete="if (!args.validationFailed) {updateUI();}" update="growlDisenyoFormulario" />
					<p:commandButton id="btnCampoSelector" 	title="#{msg['dialogDisenyoFormulario.componente.SE']}" icon="fa fa-caret-square-o-down" actionListener="#{dialogDisenyoFormulario.insertaSelector}" process="@form" oncomplete="if (!args.validationFailed) {updateUI();}" update="growlDisenyoFormulario"/>
		       		<p:commandButton id="btnCampoCheckbox" 	title="#{msg['dialogDisenyoFormulario.componente.CK']}" icon="fa fa-check-square" actionListener="#{dialogDisenyoFormulario.insertaCheckBox}" process="@form" oncomplete="if (!args.validationFailed) {updateUI();}" update="growlDisenyoFormulario"/>
				</h:panelGroup>

	       		<h:panelGroup class="ui-separator margin-right-10" rendered="#{dialogDisenyoFormulario.isNotConsulta()}">
                	<span class="ui-icon ui-icon-grip-dotted-vertical" />
           		</h:panelGroup>

				<h:panelGroup class="barra-herramientas-disenyo" rendered="#{dialogDisenyoFormulario.isNotConsulta()}">
					<p:outputLabel for="posicionamiento" value="#{msg['dialogDisenyoFormulario.posicionamiento']}"/>
					<p:selectOneButton id="posicionamiento" value="#{dialogDisenyoFormulario.posicionamiento}">
            			<f:selectItem itemLabel="#{msg['dialogDisenyoFormulario.posicionamiento.previo']}" itemValue="#{Constantes.POSICIONAMIENTO_PREVIO}" />
            			<f:selectItem itemLabel="#{msg['dialogDisenyoFormulario.posicionamiento.posterior']}" itemValue="#{Constantes.POSICIONAMIENTO_POSTERIOR}" />
            		</p:selectOneButton>
				</h:panelGroup>

	       		<h:panelGroup class="ui-separator margin-right-10" rendered="#{dialogDisenyoFormulario.isNotConsulta()}">
                	<span class="ui-icon ui-icon-grip-dotted-vertical" />
           		</h:panelGroup>

				<h:panelGroup id="bh-mover" class="barra-herramientas-disenyo" rendered="#{dialogDisenyoFormulario.isNotConsulta()}">
					<p:outputLabel for="posicionamiento" value="#{msg['dialogDisenyoFormulario.mover']}"/>
					<p:commandButton icon="fa fa-chevron-left"  id="MoverObjIzq" actionListener="#{dialogDisenyoFormulario.moverObjetoIzq}" process="@this" update="growlDisenyoFormulario formulario-panel componente-panel bh-mover" disabled="#{!dialogDisenyoFormulario.habilitadoBtnObjIzq}" title="#{msg['dialogDisenyoFormulario.title.moverIzq']}"/>
					<p:commandButton icon="fa fa-chevron-right" id="MoverObjDer" actionListener="#{dialogDisenyoFormulario.moverObjetoDer}" process="@this" update="growlDisenyoFormulario formulario-panel componente-panel bh-mover" disabled="#{!dialogDisenyoFormulario.habilitadoBtnObjDer}" title="#{msg['dialogDisenyoFormulario.title.moverDer']}"/>
				</h:panelGroup>

			</p:toolbarGroup>
			<p:toolbarGroup align="right">
				<p:commandButton id="btnHelp" title="#{msg['botones.ayuda']}" icon="fa fa-question-circle-o" actionListener="#{dialogDisenyoFormulario.ayudar}" process="@this" update="growlDisenyoFormulario"/>
			</p:toolbarGroup>
		</p:toolbar>


		<!-- Remote command invocado al seleccionar componente en iframe -->
		<p:remoteCommand name="seleccionarElementoCommand"
		 		actionListener="#{dialogDisenyoFormulario.editarComponente}"
				process="@this" update="growlDisenyoFormulario, componente-panel, bh-mover" />

		<p:remoteCommand name="updateUI" process="@this" update="formulario-panel componente-panel bh-mover botonera" />

		<!-- Dialogo confirmar cambios desde view a traves de boton oculto -->
	    <p:commandButton value="Confirmation" id="confirmationButton" widgetVar="confirmationButton" onclick="PF('dlgConfirmar').show();" styleClass="no-display"  />

	    <p:confirmDialog header="#{msg['confirm.componente.guardar.titulo']}" id="dlgConfirmar" widgetVar="dlgConfirmar" modal="true" message="#{msg['confirm.componente.guardar']}" styleClass="confirmar_ancho">
	    	<p:outputPanel styleClass="confirmar_botonera">
            <p:commandButton value="Si" actionListener="#{dialogDisenyoFormulario.confirmacionCambios}" styleClass="boton-azul" icon="ui-icon-check" onclick="PF('dlgConfirmar').hide();" process="@this"  update="growlDisenyoFormulario formulario-panel componente-panel bh-mover" />
            <p:commandButton value="No" actionListener="#{dialogDisenyoFormulario.descartarCambios}"  icon="ui-icon-close" onclick="PF('dlgConfirmar').hide();" process="@this"  update="growlDisenyoFormulario"  />
            </p:outputPanel>
        </p:confirmDialog>

		<!-- Dialogo confirmar eliminar componente desde view a traves de boton oculto -->
	    <p:commandButton id="confirmarEliminar" widgetVar="confirmarEliminar" onclick="PF('dlgConfirmarEliminar').show();" styleClass="no-display" />

	    <p:confirmDialog header="#{msg['confirm.componente.eliminar.titulo']}" id="dlgConfirmarEliminar" widgetVar="dlgConfirmarEliminar" modal="true" message="#{msg['confirm.componente.eliminar']}" styleClass="confirmar_ancho">
	    	<p:outputPanel styleClass="confirmar_botonera">
            <p:commandButton value="Si" actionListener="#{dialogDisenyoFormulario.eliminarObjetoFormulario}" styleClass="boton-azul" icon="ui-icon-check" onclick="PF('dlgConfirmarEliminar').hide();" process="@this" update="growlDisenyoFormulario formulario-panel componente-panel bh-mover" />
            <p:commandButton value="No" icon="ui-icon-close" onclick="PF('dlgConfirmarEliminar').hide();" process="@this"/>
            </p:outputPanel>
        </p:confirmDialog>

		<!-- Workpanel: Iframe HTML + Editor campos  -->
		<h:panelGrid columns="2" columnClasses="w70 grid-left va-top formulario-panel, w30 grid-left va-top formulario-panel" styleClass="w100">

			<p:outputPanel id="formulario-panel" styleClass="w100 h100">
				<iframe id="formulario-frame" name="formulario-frame" src="#{dialogDisenyoFormulario.urlIframe}" class="formulario-frame">
				  <p>Tu navegador no soporta iframes.</p>
				</iframe>
			 </p:outputPanel>

			<p:panel id="componente-panel" styleClass="h100 sin-bordes noPadding" header="#{msg['dialogDisenyoFormulario.componente.panelPropiedadesElemento']}" toggleable="false" >
			   <ui:include src="#{dialogDisenyoFormulario.panelPropiedadesUrl}">
			   </ui:include>
			 </p:panel>
		</h:panelGrid>


		<!-- Botonera abajo -->

		<p:outputPanel styleClass="botonera" id="botonera">
			<p:panelGrid columns="4" columnClasses="w20,w35 grid-right,w15 grid-left,w30" layout="grid" styleClass="formulario-botonera">

				<p:outputPanel styleClass="barra-herramientas-disenyo" id="bh-paginas">
					<p:commandButton icon="fa fa-chevron-left"  id="izq" actionListener="#{dialogDisenyoFormulario.moverPaginaIzq}" process="@this" update="growlDisenyoFormulario componente-panel formulario-panel bh-mover botonera" disabled="#{!dialogDisenyoFormulario.habilitadoBtnPagIzq}"  title="#{msg['dialogDisenyoFormulario.title.pagAnterior']}"/>
					<p:outputLabel value="Pag" /><p:outputLabel id="paginaActual" value="#{dialogDisenyoFormulario.paginaActual}" /><p:outputLabel value="/" /><p:outputLabel value="#{dialogDisenyoFormulario.numeroPaginas}" />
					<p:commandButton icon="fa fa-chevron-right" id="der" actionListener="#{dialogDisenyoFormulario.moverPaginaDer}" process="@this" update="growlDisenyoFormulario componente-panel formulario-panel bh-mover botonera" disabled="#{!dialogDisenyoFormulario.habilitadoBtnPagDer}"  title="#{msg['dialogDisenyoFormulario.title.pagPosterior']}"/>
				</p:outputPanel>

				<p:outputPanel>
					<p:commandButton value="#{msg['dialogDisenyoFormulario.botones.aplicarCambios']}" actionListener="#{dialogDisenyoFormulario.aplicarCambios}" process="@form" oncomplete="if (!args.validationFailed) {updateUI();}" update="growlDisenyoFormulario" rendered="#{dialogDisenyoFormulario.isNotConsulta()}"/>
					<p:commandButton value="#{msg['dialogDisenyoFormulario.botones.borrarComponente']}" actionListener="#{dialogDisenyoFormulario.validarEliminarObjetoFormulario}" process="@this" update="growlDisenyoFormulario" rendered="#{dialogDisenyoFormulario.isNotConsulta()}" />
					<p:commandButton value="#{msg['dialogDisenyoFormulario.botones.verEstructura']}" actionListener="#{dialogDisenyoFormulario.abrirDialogoEstructura}" process="@this" update="growlDisenyoFormulario" />
				</p:outputPanel>

				<p:outputPanel>
	         		<p:selectOneMenu id="idioma" value="#{dialogDisenyoFormulario.idioma}">
	         			<p:ajax event="blur" process="@this" />
	         			<p:ajax event="change" update="formulario-panel"/>
						<f:selectItems value="#{dialogDisenyoFormulario.idiomas}" var="lang" itemValue="#{lang}" itemLabel="#{msg[lang]}"/>
				    </p:selectOneMenu>
				 </p:outputPanel>

				<p:outputPanel styleClass="confirmar_botonera">
					<p:commandButton value="#{msg['botones.cerrar']}" actionListener="#{dialogDisenyoFormulario.cancelar}" process="@this"/>
				</p:outputPanel>
			</p:panelGrid>
		</p:outputPanel>
	</h:form>


</h:body>

</f:view>
</html>
