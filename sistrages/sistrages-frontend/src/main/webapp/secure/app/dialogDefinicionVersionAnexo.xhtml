<!DOCTYPE html>
<html lang="#{sessionBean.lang}" xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:pe="http://primefaces.org/ui/extensions"
	xmlns:p="http://primefaces.org/ui">

<p:importEnum type="es.caib.sistrages.core.api.model.types.TypeScriptFlujo" var="TypeScriptFlujo" />

<f:view locale="#{sessionBean.locale}" encoding="UTF-8" contentType="text/html">

	<h:head>
		<title>
			<h:outputText value="#{msg['dialogDefinicionVersionAnexo.titulo']}" />
		</title>

		<!-- Parametros dialogo -->
		<f:metadata>
			<f:viewParam name="MODO_ACCESO" value="#{dialogDefinicionVersionAnexo.modoAcceso}"/>
			<f:viewParam name="ID" value="#{dialogDefinicionVersionAnexo.id}" />
			<f:viewParam name="TRAMITEVERSION" value="#{dialogDefinicionVersionAnexo.idTramiteVersion}"/>
			<f:viewParam name="ENTIDAD" value="#{dialogDefinicionVersionAnexo.idEntidad}" />
			<f:viewParam name="TRAMITEPASO" value="#{dialogDefinicionVersionAnexo.idPaso}" />
			<f:viewAction action="#{dialogDefinicionVersionAnexo.init}" />
		</f:metadata>

	 	<f:facet name="last">
    		<h:outputStylesheet library="css" name="style.css" />
  		</f:facet>

	</h:head>



<h:body>

	<p:importEnum type="es.caib.sistrages.core.api.model.types.TypeFormularioObligatoriedad" var="TypeFormularioObligatoriedad" />
	<p:importEnum type="es.caib.sistrages.core.api.model.types.TypePresentacion" var="TypePresentacion" />
	<p:importEnum type="es.caib.sistrages.core.api.model.types.TypeExtension" var="TypeExtension" />
	<p:importEnum type="es.caib.sistrages.core.api.model.types.TypeTamanyo" var="TypeTamanyo" />
	<p:importEnum type="es.caib.sistrages.core.api.model.types.TypeTipoDocumental" var="TipoDocumental" />

	<h:form id="formDialogDefinicionVersionAnexo" styleClass="h100">
		<h:outputScript >

			  var arrayCm = [];

				  window.onload=function(){
			    let contextMenu =  document.getElementsByClassName('ui-contextmenu')[0];
				onVisible(contextMenu, () => eliminarResaltar());

				document.addEventListener('contextmenu', function(ev) {
			    	ev.preventDefault();
			    	getPos();
			    	return false;
				}, false);
			  }

				function eliminarResaltar(){
					let contextMenu =  document.getElementsByClassName('ui-contextmenu')[0];
			  		let elementos = document.getElementsByClassName('resaltar');
			  		if(contextMenu!=null &amp;&amp; contextMenu.style.display=='none' &amp;&amp; elementos.length &gt; 0){
						for(let i = 0; i &lt; elementos.length; i++){
							elementos[i].classList.remove('resaltar');
						}
			  		}
				}

				function onVisible(element, callback) {
				  new IntersectionObserver((entries, observer) => {
				    entries.forEach(entry => {
				      if(entry.intersectionRatio == 0) {
				        callback(element);
				      }
				    });
				  }).observe(element);
				}

			  function getPos(){
			 	var e = window.event;

			    var posX = e.clientX;
			    var posY = e.clientY;
			    var el = document.elementFromPoint(posX, posY);

			    let elementos = document.getElementsByClassName('resaltar');
			  		if(elementos.length &gt; 0){
						for(let i = 0; i &lt; elementos.length; i++){
							elementos[i].classList.remove('resaltar');
						}
			  		}

				el.classList.add("resaltar");
				var aux = document.getElementById("formDialogDefinicionVersionAnexo:auxCopiar");
				if(el.textContent!='' &amp;&amp; el.textContent!='ui-button'){
					aux.value = el.textContent;
				}else if(el.firstChild!=null &amp;&amp; el.firstChild.value!=undefined){
					aux.value = el.firstChild.value;
				}else if(el.value!=null &amp;&amp; el.value!=''){
					aux.value = el.value;
				}else{
		          aux.value = '';
		        }
				  if(aux.value!='' ){
            var multiple = false;
            var hijos = el.children;
			if((el.tagName == 'UL' || el.tagName == 'TABLE' || el.tagName == 'TR') &amp;&amp; hijos.length &gt; 1){
		            multiple = true;
		                  }else if(hijos.length &gt;= 1 ){
		                  	if(hijos.length==1  &amp;&amp; hijos[0].tagName=='DIV'){
		                  		hijos = hijos[0].children;
		                  	}
			                    for(i=0;i&lt;hijos.length;i++){
					              if(hijos[i].tagName!='SPAN' &amp;&amp; hijos[i].tagName!='LABEL'){
					                multiple=true;
					              }
			                    }

		                  }
                  var listaCm = document.getElementsByClassName('ui-contextmenu');
                  if(multiple){
                    for(i=0;i&lt;listaCm.length;i++){
                    	if(listaCm[i].style.display=='block'  &amp;&amp; !arrayCm.includes(listaCm[i])){
                    		arrayCm.push(listaCm[i]);
                    	}
	                	listaCm[i].classList.add("d-none");
					}
                  }else{
                  	for(i=0;i&lt;listaCm.length;i++){
                  		if(listaCm[i].style.display=='block'  &amp;&amp; !arrayCm.includes(listaCm[i])){
                    		arrayCm.push(listaCm[i]);
                    	}
	                	listaCm[i].classList.remove("d-none");
					}
					if(arrayCm.length&gt;1){
						arrayCm.pop();
						for(let i=0; i&lt;arrayCm.length; i++){
							arrayCm[i].style.display='none';
						}
					}
					arrayCm = [];
                  }

               }
			 }

			</h:outputScript>

		<!-- Growl mensajes -->
		<p:growl id="growl" widgetVar="growl" life="#{sessionBean.growlLife}" sticky="#{sessionBean.growlSticky}" />

       	<h:panelGrid columns="2"  rowClasses=", ui-datatable-odd"  columnClasses="w20 grid-left, w80 grid-left" styleClass="w100 h100" cellpadding="10" cellspacing="0">

            <p:outputLabel for="identificador" value="#{msg['dialogDefinicionVersionAnexo.identificador']}" />
          	<p:inputText id="identificador" required="true" styleClass="w25" value="#{dialogDefinicionVersionAnexo.data.identificador}" onblur="this.value = this.value.toUpperCase().trim();" maxlength="20" validatorMessage="#{msg['error.validacion.identificador']}">
				<p:keyFilter regEx="/[a-z0-9_-]/i" preventPaste="false"/>
				<f:validateRegex pattern="^[a-zA-Z0-9_-]{1,20}$" />
				<p:ajax event="change" listener="#{dialogDefinicionVersionAnexo.setCambios}" process="@this" update="@this"/>
          	</p:inputText>

 			<p:outputLabel for="descripcion" value="#{msg['dialogDefinicionVersionAnexo.descripcion']}" />
            <p:outputPanel styleClass="ui-inputgroup">
           		<p:inputText id="descripcion" readonly="true" required="true" styleClass="w85" value="#{dialogDefinicionVersionAnexo.data.descripcion.getTraduccion(sessionBean.lang,dialogDefinicionVersionAnexo.idiomas)}" onblur="this.value = this.value.trim();"/>
           		<p:commandButton icon="fa fa-language" actionListener="#{dialogDefinicionVersionAnexo.editarDescripcion()}"
						process="@this" update="growl">
						<p:ajax event="dialogReturn" listener="#{dialogDefinicionVersionAnexo.returnDialogoDescripcion}" update="growl descripcion" />
		        </p:commandButton>
       		</p:outputPanel>

       		<p:outputLabel 	for="tipoDocumental" value="#{msg['dialogDefinicionVersionAnexo.tipoDocumental']}" />
            <p:selectOneMenu id="tipoDocumental" layout="pageDirection" value="#{dialogDefinicionVersionAnexo.data.tipoDocumental}" style="width:150px;margin-right:10px; margin-top:7px" required="true" >
					     <f:selectItems value="#{TipoDocumental.ALL_VALUES}" var="tipoDocumental" itemLabel="#{msg['typeTipoDocumental.' += tipoDocumental]}" itemValue="#{tipoDocumental}"  />
					     <p:ajax event="change" listener="#{dialogDefinicionVersionAnexo.setCambios}" process="@this" update="@this"/>
			</p:selectOneMenu>

         	<p:outputLabel value="#{msg['dialogDefinicionVersionAnexo.obligatoriedad']}" />
         	<p:panelGrid styleClass="noBorders" columns="2" columnClasses="noPadding-left,">
	         	<p:selectOneRadio id="obligatoriedad" value="#{dialogDefinicionVersionAnexo.data.obligatoriedad}">
		            <f:selectItems value="#{TypeFormularioObligatoriedad.ALL_VALUES}" var="tipo" itemLabel="#{msg['typeFormularioObligatoriedad.' += tipo]}" />
					<p:ajax event="change" listener="#{dialogDefinicionVersionAnexo.setCambios}" process="@this" update="@this"/>
			     </p:selectOneRadio>

		     	<p:commandButton id="btnScriptObligatoriedad" icon="fa fa-bolt" actionListener="#{dialogDefinicionVersionAnexo.editarScript(TypeScriptFlujo.SCRIPT_DEPENDENCIA_DOCUMENTO.name(), dialogDefinicionVersionAnexo.data.scriptObligatoriedad)}" value="#{msg['script.SCRIPT_DEPENDENCIA_DOCUMENTO.titulo']}"
					styleClass="#{dialogDefinicionVersionAnexo.getColorScript(dialogDefinicionVersionAnexo.data.scriptObligatoriedad)}"
					process="@this" update="growl">
					<p:ajax event="dialogReturn" listener="#{dialogDefinicionVersionAnexo.returnDialogoObligatoriedad}" update="growl btnScriptObligatoriedad" />
				</p:commandButton>
         	</p:panelGrid>

        	<p:outputLabel value="#{msg['dialogDefinicionVersionAnexo.ayuda']}" />
        	<p:outputPanel>
	        	<h:panelGrid columns="2" columnClasses="noPadding-left wpx120," styleClass="w100">

					<p:outputLabel value="#{msg['dialogDefinicionVersionAnexo.ayuda.fichero']}" />
					<p:column>
						<h:outputText  id="ficheroVacio" value="#{msg['error.noexistefitxer']}" rendered="#{empty dialogDefinicionVersionAnexo.data.ayudaFichero}"/>
		           		<p:commandLink id="ficheroLink" action="#{dialogDefinicionVersionAnexo.descargaFichero(dialogDefinicionVersionAnexo.data.ayudaFichero)}" target="_blank" value="#{dialogDefinicionVersionAnexo.data.ayudaFichero.nombre}" rendered="#{!empty dialogDefinicionVersionAnexo.data.ayudaFichero}"/>
		           		<p:spacer width="20" height="1"/>
		           		<p:commandButton id="btnFichero" icon="fa fa-cog" process="@this" update="growl" actionListener="#{dialogDefinicionVersionAnexo.subirFichero()}" disabled="#{!dialogDefinicionVersionAnexo.permiteEditar}">
		           			<p:ajax event="dialogReturn" listener="#{dialogDefinicionVersionAnexo.returnDialogoFichero}" update="formDialogDefinicionVersionAnexo ficheroVacio ficheroLink growl "/>
		           			<p:confirm header="#{msg['confirm.titulo']}" message="#{msg['confirm.uploadDoc']}" icon="fa fa-question-circle fa-3x confirmar_icono"/>
		           		</p:commandButton>
					</p:column>

					<p:outputLabel value="#{msg['dialogDefinicionVersionAnexo.ayuda.url']}" />
					<p:inputText id="url_input"  styleClass="w85" value="#{dialogDefinicionVersionAnexo.data.ayudaURL}" maxlength="250" onblur="this.value = this.value.trim();">
						<p:ajax event="change" listener="#{dialogDefinicionVersionAnexo.setCambios}" process="@this" update="@this"/>
					</p:inputText>

					<p:outputLabel value="#{msg['dialogDefinicionVersionAnexo.ayuda.mensaje']}" />
					<p:outputPanel styleClass="ui-inputgroup">
	           			<p:inputText id="mensaje_input" readonly="true" styleClass="w85" value="#{dialogDefinicionVersionAnexo.data.ayudaTexto.getTraduccion(sessionBean.lang,dialogDefinicionVersionAnexo.idiomas)}" onblur="this.value = this.value.trim();"/>
	           			<p:commandButton icon="fa fa-language" actionListener="#{dialogDefinicionVersionAnexo.editarAyudaTexto()}"
							process="@this" update="growl">
							<p:ajax event="dialogReturn" listener="#{dialogDefinicionVersionAnexo.returnDialogoAyudaTexto}" update="growl mensaje_input" />
		        		</p:commandButton>
	       			</p:outputPanel>

	         	</h:panelGrid>
			</p:outputPanel>

         	<p:outputLabel value="#{msg['dialogDefinicionVersionAnexo.tipopresentacion']}" />
        	<p:outputPanel>
	        	<p:selectOneRadio id="tipopresentacion" value="#{dialogDefinicionVersionAnexo.data.tipoPresentacion}" layout="custom">
		        	<f:selectItems value="#{TypePresentacion.ALL_VALUES}" var="tipo" itemLabel="#{msg['typePresentacion.' += tipo]}" />
		        	<p:ajax event="change" listener="#{dialogDefinicionVersionAnexo.setCambios}" process="@this" update="@this"/>
	        	</p:selectOneRadio>
	         	<h:panelGrid columns="2" columnClasses="noPadding-left wpx100 padding8," styleClass="w100">
					<p:outputPanel>
						<p:radioButton id="electronica" for="tipopresentacion" itemIndex="0" />
						<p:spacer width="8" height="1"/>
						<p:outputLabel value="#{msg['dialogDefinicionVersionAnexo.tipopresentacion.electronica']}" />
					</p:outputPanel>


					<h:panelGrid columns="2" columnClasses="wpx120 grid-right, padding-left-4" styleClass="panel_izq w100">
						<p:outputLabel value="#{msg['dialogDefinicionVersionAnexo.tipopresentacion.electronica.numinstancias']}" for="numinstancias"/>
						<p:panelGrid styleClass="noBorders" columns="2" columnClasses="noPadding-left,">
							<p:inputText id="numinstancias" size="3" value="#{dialogDefinicionVersionAnexo.data.numeroInstancia}" maxlength="2" onblur="this.value = this.value.trim();">
								<p:ajax event="change" listener="#{dialogDefinicionVersionAnexo.setCambios}" process="@this" update="@this"/>
							</p:inputText>
						</p:panelGrid>

						<p:panelGrid columns="1" columnClasses="grid-right noPadding-right" styleClass="w100 noBorders">
							<p:outputLabel value="#{msg['dialogDefinicionVersionAnexo.tipopresentacion.electronica.extensiones']}" />
							<p:spacer width="8" height="1"/>
						</p:panelGrid>
						<p:panelGrid styleClass="noBorders" columns="3" columnClasses="noPadding-left,,noPadding-left">
							<p:panelGrid columns="1">
								<p:selectOneRadio id="extensiones" value="#{dialogDefinicionVersionAnexo.data.extensionSeleccion}" disabled="#{dialogDefinicionVersionAnexo.data.debeAnexarFirmado and !dialogDefinicionVersionAnexo.data.debeFirmarDigitalmente}">
						        	<f:selectItem itemLabel="#{msg['dialogDefinicionVersionAnexo.tipopresentacion.electronica.extensiones.todas']}" itemValue="#{TypeExtension.TODAS}"/>
						        	<f:selectItem itemLabel="#{msg['dialogDefinicionVersionAnexo.tipopresentacion.electronica.extensiones.personalizadas']}" itemValue="#{TypeExtension.PERSONALIZADAS}"/>
									<p:ajax event="change" listener="#{dialogDefinicionVersionAnexo.setCambios}" process="@this" update="@this :formDialogDefinicionVersionAnexo:personalizadas_input"/>
					        	</p:selectOneRadio>
					        	<p:spacer width="8" height="1"/>
				        	</p:panelGrid>
				        	<p:panelGrid columns="1">
				        		<p:inputText id="personalizadas_input" size="15" value="#{dialogDefinicionVersionAnexo.data.extensiones}" onblur="this.value = this.value.trim();" readonly="#{(dialogDefinicionVersionAnexo.data.debeAnexarFirmado and !dialogDefinicionVersionAnexo.data.debeFirmarDigitalmente)  or (dialogDefinicionVersionAnexo.data.extensionSeleccion eq TypeExtension.TODAS)}">
				        			<p:ajax event="change" listener="#{dialogDefinicionVersionAnexo.setCambios}" process="@this" update="@this" />
				        		</p:inputText>
				        		<p:outputLabel value="#{msg['dialogDefinicionVersionAnexo.tipopresentacion.electronica.extensiones.formato']}" escape="true"/>
				        	</p:panelGrid>
						</p:panelGrid>

						<p:outputLabel value="#{msg['dialogDefinicionVersionAnexo.tipopresentacion.electronica.tammaximo']}" for="tammaximo" />
						<p:panelGrid styleClass="noBorders" columns="4" columnClasses="noPadding-left,noPadding-left">
							<p:inputText id="tammaximo" size="3" onblur="this.value = this.value.trim();" value="#{dialogDefinicionVersionAnexo.data.tamanyoMaximo}" maxlength="4" >
								<p:ajax event="change" listener="#{dialogDefinicionVersionAnexo.setCambios}" process="@this" update="@this"/>
							</p:inputText>
							<p:selectOneRadio id="tipotam" columns="1" value="#{dialogDefinicionVersionAnexo.data.tipoTamanyo}">
						        	<f:selectItems value="#{TypeTamanyo.ALL_VALUES}" var="tipo" itemLabel="#{msg['typeTamanyo.' += tipo]}" />
									<p:ajax event="change" listener="#{dialogDefinicionVersionAnexo.setCambios}" process="@this" update="@this"/>
					        </p:selectOneRadio>


							<p:spacer width="8" height="1"/>
							<p:selectBooleanCheckbox id="convertirpdf" value="#{dialogDefinicionVersionAnexo.data.debeConvertirPDF}" itemLabel="#{msg['dialogDefinicionVersionAnexo.tipopresentacion.electronica.convertirpdf']}" disabled="#{dialogDefinicionVersionAnexo.data.debeAnexarFirmado and !dialogDefinicionVersionAnexo.data.debeFirmarDigitalmente}">
								<p:ajax event="change" listener="#{dialogDefinicionVersionAnexo.setCambios}" process="@this" update="@this"/>
							</p:selectBooleanCheckbox>
						</p:panelGrid>

						<p:outputLabel value="#{msg['viewDefinicionVersionAnexo.tipopresentacion.electronica.firma']}"  />
						<p:panelGrid styleClass="noBorders" columns="3" columnClasses="noPadding-left,noPadding-left">

						    <p:selectBooleanCheckbox itemLabel="#{msg['dialogDefinicionVersionAnexo.tipopresentacion.electronica.anexarfirmado']}" id="debeAnexarFirmado" value="#{dialogDefinicionVersionAnexo.data.debeAnexarFirmado}" >
						    	<p:ajax event="change" listener="#{dialogDefinicionVersionAnexo.setCambios}" process="@this" update="@this :formDialogDefinicionVersionAnexo:extensiones :formDialogDefinicionVersionAnexo:personalizadas_input :formDialogDefinicionVersionAnexo:convertirpdf"/>
						    </p:selectBooleanCheckbox>

						    <p:selectBooleanCheckbox itemLabel="#{msg['dialogDefinicionVersionAnexo.tipopresentacion.electronica.firmar']}" id="debeFirmarDigitalmente" value="#{dialogDefinicionVersionAnexo.data.debeFirmarDigitalmente}" >
						    	<p:ajax event="change" listener="#{dialogDefinicionVersionAnexo.setCambios}" process="@this" update="@this :formDialogDefinicionVersionAnexo:extensiones :formDialogDefinicionVersionAnexo:personalizadas_input :formDialogDefinicionVersionAnexo:convertirpdf"/>
						    </p:selectBooleanCheckbox>

							<p:commandButton id="btnScriptFirma" icon="fa fa-bolt" actionListener="#{dialogDefinicionVersionAnexo.editarScript(TypeScriptFlujo.SCRIPT_FIRMANTES.name(), dialogDefinicionVersionAnexo.data.scriptFirmarDigitalmente)}" value="#{msg['script.SCRIPT_FIRMANTES.titulo']}"
									styleClass="#{dialogDefinicionVersionAnexo.getColorScript(dialogDefinicionVersionAnexo.data.scriptFirmarDigitalmente)}"
									process="@this" update="growl">
										<p:ajax event="dialogReturn" listener="#{dialogDefinicionVersionAnexo.returnDialogoFirmarDigitalmente}" update="growl btnScriptFirma" />
							</p:commandButton>
						</p:panelGrid>

						<p:outputLabel value="#{msg['script.SCRIPT_VALIDAR_ANEXO.titulo']}" />
						<p:commandButton id="btnScriptValidacion" icon="fa fa-bolt" actionListener="#{dialogDefinicionVersionAnexo.editarScript(TypeScriptFlujo.SCRIPT_VALIDAR_ANEXO.name(), dialogDefinicionVersionAnexo.data.scriptValidacion)}"
									styleClass="#{dialogDefinicionVersionAnexo.getColorScript(dialogDefinicionVersionAnexo.data.scriptValidacion)}"
									process="@this" update="growl">
									<p:ajax event="dialogReturn" listener="#{dialogDefinicionVersionAnexo.returnDialogoValidacion}" update="growl btnScriptValidacion" />
						</p:commandButton>

					</h:panelGrid>


					<p:spacer width="8" height="1"/>

	         	</h:panelGrid>
			</p:outputPanel>


			<f:facet name = "footer">
				<p:outputPanel id="toolbar" styleClass="grid-right">
					<p:commandButton value="#{msg['botones.guardar']}" actionListener="#{dialogDefinicionVersionAnexo.aceptar()}" process="@form" update="@form growl"  styleClass="boton-azul" />
					<p:commandButton value="#{msg['botones.cancelar']}" actionListener="#{dialogDefinicionVersionAnexo.cancelar()}" process="@this"/>
					<p:commandButton id="btnHelp" value="#{msg['botones.ayuda']}" icon="fa fa-question-circle-o" actionListener="#{dialogDefinicionVersionAnexo.ayuda()}" process="@this"/>
				</p:outputPanel>
			</f:facet>

		</h:panelGrid>
		<p:contextMenu>
       			<p:menuitem value="#{msg['botones.copiar']}" icon="fa fa-clipboard" styleClass="w90" id="mnuCopy"  process="@this :formDialogDefinicionVersionAnexo:auxCopiar" update="growl" />
		    </p:contextMenu>
		    <pe:clipboard id="clipContextCopy" trigger="mnuCopy" action="copy" target="auxCopiar">
				<p:ajax event="success" listener="#{dialogDefinicionVersionAnexo.copiadoCorr}" process="@this" update="@this growl"/>
            	<p:ajax event="error" listener="#{dialogDefinicionVersionAnexo.copiadoErr}" update="@this growl"/>
        	</pe:clipboard>

		    <p:inputText id="auxCopiar" value="#{dialogDefinicionVersionAnexo.portapapeles}" style="padding:0px; opacity:0; width: 1px; height:1px; cursor:default;"/>
	</h:form>
	<p:confirmDialog global="true" >
		<p:outputPanel styleClass="confirmar_botonera">
        	<p:commandButton value="#{msg['botones.si']}" type="button" styleClass="ui-confirmdialog-yes boton-azul" icon="fa fa-check"  process="@form"/>
        	<p:commandButton value="#{msg['botones.no']}" type="button" styleClass="ui-confirmdialog-no" icon="fa fa-close" process="@this"/>
        </p:outputPanel>
    </p:confirmDialog>
</h:body>
</f:view>
</html>