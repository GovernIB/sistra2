<!DOCTYPE html>
<html lang="#{sessionBean.lang}"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui">

<f:view locale="#{sessionBean.locale}" encoding="UTF-8" contentType="text/html">
<p:importEnum type="es.caib.sistrages.core.api.model.types.TypeScriptFormulario" var="TypeScriptFormulario" />

<h:head>
	<title><h:outputText value="#{msg['dialogPropiedadesFormulario.titulo']}"/></title>
</h:head>

<h:body>
  	<f:facet name="last">
    	<h:outputStylesheet library="css" name="style.css" />
  	</f:facet>

	<!-- Parametros dialogo -->
	<f:metadata>
		<f:viewParam name="MODO_ACCESO" value="#{dialogPropiedadesFormulario.modoAcceso}"/>
		<f:viewParam name="ID" value="#{dialogPropiedadesFormulario.id}"/>
		<f:viewParam name="FORMULARIO_ACTUAL" value="#{dialogPropiedadesFormulario.idFormularioTramite}"/>
		<f:viewParam name="TRAMITEVERSION" value="#{dialogPropiedadesFormulario.idTramiteVersion}"/>
		<f:viewAction action="#{dialogPropiedadesFormulario.init}" />
	</f:metadata>
	<h:form styleClass="margin-top-10" id="form">
  			<p:outputPanel>
				<!-- Contenido dialogo -->
				<!-- Growl mensajes -->
				<p:growl id="growlDialog" widgetVar="growlDialog" life="#{sessionBean.growlLife}" sticky="#{sessionBean.growlSticky}"  />

				<h:panelGrid rowClasses=",ui-datatable-odd" columnClasses="w25 padding-left-18,w75" styleClass="w100" columns="2" cellpadding="5">
					<p:outputLabel for="permitirAccionesPersonalizadas" value="#{msg['dialogPropiedadesFormulario.permitirAccionesPersonalizadas']}" rendered="false"/>
				 	<p:selectBooleanCheckbox id="permitirAccionesPersonalizadas" value="#{dialogPropiedadesFormulario.data.permitirAccionesPersonalizadas}" disabled="#{dialogPropiedadesFormulario.consulta}"  rendered="false"/>

					<p:outputLabel for="cabeceraFormulario" value="#{msg['dialogPropiedadesFormulario.cabeceraFormulario']}" />
					<p:outputPanel>
					 	<p:selectBooleanCheckbox id="cabeceraFormulario" value="#{dialogPropiedadesFormulario.data.mostrarCabecera}" styleClass="margin-right-10" disabled="#{dialogPropiedadesFormulario.consulta}">
					 		<p:ajax update="@form" event="change"/>
					 	</p:selectBooleanCheckbox>

						<p:outputLabel for="textoCabeceraHidden" value="#{msg['dialogPropiedadesFormulario.textoCabecera']}" styleClass="no-display"/>
						<p:inputText id="textoCabecera" value="#{dialogPropiedadesFormulario.literal}" disabled="true" required="true" size="40" styleClass="margin-right-10 #{not textoCabeceraComponent.valid ? 'ui-state-error' : ''}"/>
						<p:inputText id="textoCabeceraHidden" value="#{dialogPropiedadesFormulario.literal}" type="hidden" required="#{dialogPropiedadesFormulario.data.mostrarCabecera}" binding="#{textoCabeceraComponent}"/>
						<p:commandButton id="btnNombre" icon="fa fa-language" actionListener="#{dialogPropiedadesFormulario.editarTextoCabecera}" process="@this" update="growlDialog" styleClass="va-top" disabled="#{!dialogPropiedadesFormulario.data.mostrarCabecera}" >
		            		<p:ajax event="dialogReturn" listener="#{dialogPropiedadesFormulario.returnDialogo}" update="growlDialog textoCabecera textoCabeceraHidden" />
		        		</p:commandButton>
					</p:outputPanel>

					<p:outputLabel value="#{msg['dialogPropiedadesFormulario.admPagina']}"/>
					<h:panelGrid columns="2" columnClasses="w40,w60 va-top">
						<p:dataTable  id="dataTablePaginas" var="td" value="#{dialogPropiedadesFormulario.data.paginas}"
										  rows="0" emptyMessage="#{msg['error.emptyRows']}"
										  scrollable="true" scrollHeight="98%"
				                          paginator="false" style="height:162px;width:340px"
				                          selectionMode="single" selection="#{dialogPropiedadesFormulario.paginaSeleccionada}" rowKey="#{td.orden}">

							<!-- Necesario para actualizar en controlador la fila seleccionada -->
							<p:ajax event="rowSelect" global="false"/>
							<p:ajax event="rowUnselect"/>

							<!-- Columnas -->
						    <p:column class="ui-panelgrid-cell w75" headerText="#{msg['dialogPropiedadesFormulario.pagina']}">
						        <h:outputText value="#{msg['dialogDisenyoFormulario.pagina'].concat(' ').concat(td.orden)}" />
						    </p:column>
						    <p:column class="ui-panelgrid-cell w25 grid-center" headerText="#{msg['dialogPropiedadesFormulario.paginaFinal']}" >
						       <p:selectBooleanCheckbox value="#{td.paginaFinal}" disabled="true"/>
						    </p:column>

				 		</p:dataTable>
				 		<p:outputPanel styleClass="barra-herramientas-vertical" style="margin-left:5px">
						    	<p:commandButton id="btnNuevaPagina" icon="fa fa-plus" title="#{msg['botones.nuevo']}" actionListener="#{dialogPropiedadesFormulario.nuevaPagina}" process="@this" update="growlDialog dataTablePaginas" rendered="#{dialogPropiedadesFormulario.alta or dialogPropiedadesFormulario.edicion}" />
								<ui:fragment rendered="#{dialogPropiedadesFormulario.alta or dialogPropiedadesFormulario.edicion}"><br /></ui:fragment>

								<p:commandButton id="btnEditarPagina" icon="fa fa-edit" title="#{msg['botones.editar']}" actionListener="#{dialogPropiedadesFormulario.editarPagina}" process="@this" update="growlDialog" rendered="#{dialogPropiedadesFormulario.alta or dialogPropiedadesFormulario.edicion}">
	        						<p:ajax event="dialogReturn" listener="#{dialogPropiedadesFormulario.returnDialogoPagina}" update="growlDialog dataTablePaginas"/>
	        					</p:commandButton>
	        					<ui:fragment rendered="#{dialogPropiedadesFormulario.alta or dialogPropiedadesFormulario.edicion}"><br /></ui:fragment>

						    	<p:commandButton id="btnEliminarPagina" icon="fa fa-minus"  title="#{msg['botones.eliminar']}" actionListener="#{dialogPropiedadesFormulario.eliminarPagina}" process="@this" update="growlDialog dataTablePaginas" rendered="#{dialogPropiedadesFormulario.alta or dialogPropiedadesFormulario.edicion}" />
								<ui:fragment rendered="#{dialogPropiedadesFormulario.alta or dialogPropiedadesFormulario.edicion}"><br /></ui:fragment>

						    	<p:commandButton icon="fa fa-arrow-up" title="#{msg['botones.subir']}" actionListener="#{dialogPropiedadesFormulario.subirPagina}" process="@this" update="growlDialog dataTablePaginas" rendered="#{dialogPropiedadesFormulario.alta or dialogPropiedadesFormulario.edicion}" />
								<ui:fragment rendered="#{dialogPropiedadesFormulario.alta or dialogPropiedadesFormulario.edicion}"><br /></ui:fragment>

						    	<p:commandButton icon="fa fa-arrow-down" title="#{msg['botones.bajar']}" actionListener="#{dialogPropiedadesFormulario.bajarPagina}" process="@this" update="growlDialog dataTablePaginas" rendered="#{dialogPropiedadesFormulario.alta or dialogPropiedadesFormulario.edicion}" />

						    	<p:commandButton id="btnConsultarPagina" icon="fa fa-eye" title="#{msg['botones.consultar']}" actionListener="#{dialogPropiedadesFormulario.consultarPagina}" process="@this" update="growlDialog" rendered="#{!dialogPropiedadesFormulario.alta and !dialogPropiedadesFormulario.edicion}" />

						</p:outputPanel>
			 		</h:panelGrid>

			 		<p:outputLabel value="#{msg['dialogPropiedadesFormulario.plantillaPDF']}"/>
					<h:panelGrid columns="2" columnClasses="w40,w60 va-top">
						<p:dataTable  id="dataTablePlantillas" var="td" value="#{dialogPropiedadesFormulario.data.plantillas}"
										  rows="0" emptyMessage="#{msg['error.emptyRows']}" sortBy="#{dialogPropiedadesFormulario.getDescripcionFormateador(td.idFormateadorFormulario)}"
										  scrollable="true" scrollHeight="98%"
				                          paginator="false" style="height:132px;width:620px"
				                          selectionMode="single" selection="#{dialogPropiedadesFormulario.plantillaSeleccionada}" rowKey="#{td.hashCode}">

							<!-- Necesario para actualizar en controlador la fila seleccionada -->
							<p:ajax event="rowSelect" global="false" update="form:filesPlantilla"/>
							<p:ajax event="rowUnselect" update="form:filesPlantilla"/>

							<!-- Columnas -->
							<p:column headerText="#{msg['dialogPropiedadesFormulario.formateador']}" styleClass="ui-panelgrid-cell w20" >
						        <h:outputText value="#{dialogPropiedadesFormulario.getDescripcionFormateador(td.idFormateadorFormulario)}" />
						    </p:column>
							<p:column headerText="#{msg['dialogPropiedadesFormulario.identificador']}" styleClass="ui-panelgrid-cell w20" >
						        <h:outputText value="#{td.identificador}" />
						    </p:column>
						    <p:column  headerText="#{msg['dialogPropiedadesFormulario.descripcion']}" styleClass="ui-panelgrid-cell w45">
						        <h:outputText value="#{td.descripcion}" />
						    </p:column>
		   					<p:column headerText="#{msg['dialogPropiedadesFormulario.porDefecto']}" styleClass="ui-panelgrid-cell w15 grid-center">
						        <p:selectBooleanCheckbox value="#{td.porDefecto}" disabled="true"/>
						    </p:column>


				 		</p:dataTable>
				 		 	<p:outputPanel styleClass="barra-herramientas-vertical">
						    	<p:commandButton id="btnNuevaPlantilla" icon="fa fa-plus" title="#{msg['botones.nuevo']}" actionListener="#{dialogPropiedadesFormulario.nuevaPlantilla}" process="@this" update="growlDialog dataTablePlantillas" rendered="#{dialogPropiedadesFormulario.alta or dialogPropiedadesFormulario.edicion}">
						    		<p:ajax event="dialogReturn" listener="#{dialogPropiedadesFormulario.returnDialogoPlantilla}" update="growlDialog dataTablePlantillas"/>
						    	</p:commandButton>
								<ui:fragment rendered="#{dialogPropiedadesFormulario.alta or dialogPropiedadesFormulario.edicion}"><br /></ui:fragment>

								<p:commandButton id="btnEditarPlantilla" icon="fa fa-edit" title="#{msg['botones.editar']}" actionListener="#{dialogPropiedadesFormulario.editarPlantilla}" process="@this" update="growlDialog" rendered="#{dialogPropiedadesFormulario.alta or dialogPropiedadesFormulario.edicion}">
	        						<p:ajax event="dialogReturn" listener="#{dialogPropiedadesFormulario.returnDialogoPlantilla}" update="growlDialog"/>
	        					</p:commandButton>
	        					<ui:fragment rendered="#{dialogPropiedadesFormulario.alta or dialogPropiedadesFormulario.edicion}"><br /></ui:fragment>

						    	<p:commandButton id="btnEliminarPlantilla" icon="fa fa-minus" title="#{msg['botones.eliminar']}" actionListener="#{dialogPropiedadesFormulario.eliminarPlantilla}" process="@this" update="growlDialog dataTablePlantillas" rendered="#{dialogPropiedadesFormulario.alta or dialogPropiedadesFormulario.edicion}"/>
						    	<ui:fragment rendered="#{dialogPropiedadesFormulario.alta or dialogPropiedadesFormulario.edicion}"><br /></ui:fragment>

								<p:commandButton id="filesPlantilla" icon="fa fa-file-o" title="#{msg['dialogPropiedadesFormulario.botonIdioma']}" actionListener="#{dialogPropiedadesFormulario.editarFicheroPlantilla}"
												process="@this" update="growlDialog">
									<p:confirm disabled="#{empty dialogPropiedadesFormulario.plantillaSeleccionada or dialogPropiedadesFormulario.plantillaSeleccionada.codigo gt 0}" header="#{msg['warning.titulo']}" message="#{msg['dialogPropiedadesFormulario.debeAplicar']}" icon="fa fa-exclamation-triangle fa-3x confirmar_icono"/>
									<p:ajax event="dialogReturn" update="@form growlDialog"/>
								</p:commandButton>

								<p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
							        <p:commandButton value="#{msg['botones.si']}" type="button" styleClass="ui-confirmdialog-yes" icon="ui-icon-check" process="@this"/>
							        <p:commandButton value="#{msg['botones.no']}" type="button" styleClass="ui-confirmdialog-no" icon="ui-icon-close" process="@this"/>
							    </p:confirmDialog>

							</p:outputPanel>
			 		</h:panelGrid>

					<p:outputLabel value="#{msg['dialogPropiedadesFormulario.scriptFormateador']}"/>

					<p:commandButton id="scriptPlantilla" icon="fa fa-bolt"  actionListener="#{dialogPropiedadesFormulario.editarDialogScriptPlantilla(TypeScriptFormulario.SCRIPT_PLANTILLA_PDF_DINAMICA.name(), dialogPropiedadesFormulario.data.scriptPlantilla)}" process="@this" update="growlDialog"
									styleClass="#{dialogPropiedadesFormulario.getColorScript(dialogPropiedadesFormulario.data.scriptPlantilla)}" >
						<p:ajax event="dialogReturn" listener="#{dialogPropiedadesFormulario.returnDialogoScriptPlantilla}" update="growlDialog scriptPlantilla" />
					</p:commandButton>
				</h:panelGrid>

			</p:outputPanel>
		  	 <p:outputPanel styleClass="botonera">
		     	<p:toolbar>
					<f:facet name="right">
		        		<p:commandButton value="#{msg['botones.guardar']}" actionListener="#{dialogPropiedadesFormulario.guardar}" process="@form" update="@form growlDialog" styleClass="boton-azul" rendered="#{dialogPropiedadesFormulario.alta or dialogPropiedadesFormulario.edicion}"/>
						<p:commandButton value="#{msg['botones.cancelar']}" actionListener="#{dialogPropiedadesFormulario.cancelar}" process="@this" rendered="#{dialogPropiedadesFormulario.alta or dialogPropiedadesFormulario.edicion}"/>
						<p:commandButton value="#{msg['botones.cerrar']}" actionListener="#{dialogPropiedadesFormulario.cancelar}" process="@this"  rendered="#{dialogPropiedadesFormulario.consulta}"/>
						<p:commandButton id="btnHelp" value="#{msg['botones.ayuda']}" icon="fa fa-question-circle-o" actionListener="#{dialogPropiedadesFormulario.ayuda()}" process="@this"/>
					</f:facet>
				</p:toolbar>
		    </p:outputPanel>

			<p:confirmDialog global="true">
				<p:outputPanel styleClass="confirmar_botonera">
		        	<p:commandButton value="#{msg['botones.si']}" type="button" styleClass="ui-confirmdialog-yes" icon="ui-icon-check" process="@this"/>
					<p:commandButton value="#{msg['botones.no']}" type="button" styleClass="ui-confirmdialog-no" icon="ui-icon-close" process="@this"/>
				</p:outputPanel>
		    </p:confirmDialog>



	</h:form>
</h:body>

</f:view>
</html>
