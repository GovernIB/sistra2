<!DOCTYPE html>
<html lang="#{sessionBean.lang}"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:pe="http://primefaces.org/ui/extensions"
	xmlns:p="http://primefaces.org/ui">

<f:view locale="#{sessionBean.locale}" encoding="UTF-8" contentType="text/html">


<h:head>
	<title><h:outputText value="#{msg['dialogScript.titulo']}"/></title>

  <f:facet name="last">
    <h:outputStylesheet library="css" name="style.css" />
  </f:facet>
</h:head>
<script>
 	function anyadir_texto(texto) {
	    document.getElementById("dialogScript:hiddenNuevoTexto").value(texto);
 		document.getElementById("dialogScript:hiddenCommandActualizarTexto").click();
 	}

 	function ocultar_ayuda() {
	    document.getElementById("dialogScript:hiddenCommandOcultarAyuda").click();
 	}

 	function mensaje_copy() {
 		document.getElementById("dialogScript:hiddenCommandMensajeCopy").click();
 	}

</script>

<h:body>

	<!-- Parametros dialogo -->
	<f:metadata>
		<f:viewParam name="MODO_ACCESO" value="#{dialogScript.modoAcceso}"/>
		<f:viewParam name="TIPO_SCRIPT" value="#{dialogScript.tipoScriptParam}"/>
		<f:viewParam name="DATO" value="#{dialogScript.iData}"/>
		<f:viewAction action="#{dialogScript.init}" />
	</f:metadata>
	<h:form id="dialogScript" styleClass="margin-top-10">

			<p:growl id="growlScript" widgetVar="growlScript" life="2000" sticky="false" />

					<p:panel id="panelTop" header="#{msg['script.' += dialogScript.tipoScriptParam += '.titulo']}" toggleable="false" widgetVar="panel" style="padding:0px">
						<h:panelGrid rowClasses=", ui-datatable-odd" columnClasses="padding-left-18 wpx200, padding-right-18 " columns = "2" cellpadding = "5" cellspacing = "0"  style="padding:0px">

							<h:outputLabel value="#{msg['dialogScript.sirve']}"></h:outputLabel>
							<h:outputLabel value="#{msg['script.' += dialogScript.tipoScriptParam += '.sirve']}"></h:outputLabel>

							<h:outputLabel value="#{msg['dialogScript.ejecuta']}"></h:outputLabel>
							<h:outputLabel value="#{msg['script.' += dialogScript.tipoScriptParam += '.ejecuta']}"></h:outputLabel>

							<h:outputLabel value="#{msg['dialogScript.devuelve']}"></h:outputLabel>
							<h:outputLabel value="#{msg['script.' += dialogScript.tipoScriptParam += '.devuelve']}"></h:outputLabel>

						</h:panelGrid>
					</p:panel>

    				<h:panelGrid columns="2" columnClasses="w50 grid-left va-top formulario-panel, w50 grid-center va-top formulario-panel" styleClass="w100"  >

							<pe:codeMirror  id="codeMirror"
		        							mode="#{dialogScript.mode}"
		        							theme="#{dialogScript.theme}"
		    								value="#{dialogScript.data.contenido}"
		    								keyMap="#{dialogScript.keymap}"
		    								lineNumbers="true"
		    								matchBrackets="true"
		    								readonly="#{dialogScript.isConsulta()}"
			    							styleClass="w100 h100" />

							<p:column>
								<p:column rendered="#{dialogScript.mostrarLateralAyuda}" style="text-align:center">
									<iframe src="#{dialogScript.urlIframe}" width="100%" height="400px" />
									<p:commandButton id="commandOcultarAyuda" value="#{msg['botones.ocultarAyuda']}"   styleClass="button" process="@this"  action="#{dialogScript.ocultarAyuda()}"  update="@form" style="margin-left:4px;" icon="fa fa-eye-slash" />

								</p:column>
		    					<p:panel id="panelPlugins"  header="#{msg['dialogScript.plugins.header']}" toggleable="true" widgetVar="panelPlugins"  collapsed="#{dialogScript.visibleHerramientas}" styleClass="h100 w100 sin-bordes noPadding grid-left" rendered="#{!dialogScript.mostrarLateralAyuda}">

									<p:ajax event="toggle" listener="#{dialogScript.onToggle}" update="panelPlugins panelMensajes panelDominios" />

									<h:dataTable var="plugin" value="#{dialogScript.plugins}" rowClasses="padding8" columnClasses=", wpx100" styleClass="w100">
									    <h:column>
									        <h:outputText value="#{plugin.name()}"/>
									    </h:column>
									    <h:column>
									    	<p:commandButton icon="fa fa-question" actionListener="#{dialogScript.mostrarAyuda(plugin)}" process="@this" update="@form" style="color:#c4bc20;" />
									    </h:column>
									</h:dataTable>
								</p:panel>

								<p:panel id="panelMensajes" header="#{msg['dialogScript.validacion.header']}" toggleable="true" widgetVar="panelScripts" collapsed="#{dialogScript.visibleMensajes}"  rendered="#{!dialogScript.mostrarLateralAyuda}" styleClass="sin-bordes noPadding grid-left" >

										<p:ajax event="toggle" listener="#{dialogScript.onToggle}" update="panelPlugins panelMensajes panelDominios" />
										<div style="text-align:right">
											<p:commandButton value="#{msg['botones.nuevo']}" icon="fa fa-file" actionListener="#{dialogScript.nuevoMensaje}" process="@this" update="growlScript" >
							        				<p:ajax event="dialogReturn" listener="#{dialogScript.returnDialogoMensaje}" update="growlScript @form"/>
							        		</p:commandButton>
      			   							<p:commandButton value="#{msg['botones.editar']}" icon="fa fa-edit" actionListener="#{dialogScript.editarMensaje}" process="@this" update="growlScript">
			        								<p:ajax event="dialogReturn" listener="#{dialogScript.returnDialogoMensaje}" update="growlScript @form"/>
			        						</p:commandButton>
      			   							<p:commandButton value="#{msg['botones.eliminar']}" icon="fa fa-trash-o" actionListener="#{dialogScript.eliminarMensaje}" process="@this" update="@form growlScript">
	        									<p:confirm header="#{msg['confirm.titulo']}" message="#{msg['confirm.borrado']}" icon="fa fa-question-circle fa-3x confirmar_icono"/>
	        								</p:commandButton>
      			   						</div>


      			   						 <p:dataTable id="mensaje" var="mensaje" value="#{dialogScript.mensajes}" emptyMessage="#{msg['error.emptyRows']}" scrollable="true" scrollHeight="100%"
									   		selection="#{dialogScript.mensajeSeleccionado}" rowKey="#{mensaje.identificador}" selectionMode="single" >

											<p:ajax event="rowSelect" global="false" />

									        <p:column headerText="#{msg['dialogScript.mensaje.headerIdentificador']}">
									        	<h:outputText value="#{mensaje.identificador}" />
									        </p:column>

											<p:column headerText="#{msg['dialogScript.mensaje.headerDescripcion']}">
									        	<h:outputText value="#{mensaje.literal.getTraduccion(sessionBean.lang)}" />
									        </p:column>

									    </p:dataTable>


								 </p:panel>

								    <p:panel id="panelDominios" header="#{msg['dialogScript.dominios.header']}" toggleable="true" widgetVar="panelDominios" style="margin-bottom:2px" collapsed="#{dialogScript.visibleDominios}"  rendered="#{!dialogScript.mostrarLateralAyuda}" styleClass="sin-bordes noPadding grid-left">

										<p:ajax event="toggle" listener="#{dialogScript.onToggle}" update="panelPlugins panelMensajes panelDominios" />

										<h:panelGrid columns="2" header="Scripts">
											<h:column><h:outputText value="Dominios" /></h:column>
								         	<h:inputText value="Dominios" />

								        </h:panelGrid>
								    </p:panel>

		    					</p:column>
					</h:panelGrid>

					<p:commandButton id="hiddenCommandActualizarTexto" styleClass="button" process="@this"  action="#{viewTramites.anyadirTexto()}"  style="display:none" />
      			   	<p:commandButton id="hiddenCommandOcultarAyuda"    styleClass="button" process="@this"  action="#{dialogScript.ocultarAyuda()}"  style="display:none" update="@form" />
      			   	<p:commandButton id="hiddenCommandMensajeCopy"     styleClass="button" process="@this"  action="#{dialogScript.mensajeCopy()}"  style="display:none" update="growlScript" />
      			   	<h:inputText     id="hiddenNuevoTexto" 			value="#{dialogScript.nuevoTexto}"  style="display:none" />


			<p:toolbar>
						<f:facet name="right">
			        		<p:commandButton value="#{msg['botones.cerrar']}" actionListener="#{dialogScript.cancelar()}" process="@form" update="@form growlScript"  styleClass="boton-azul" rendered="#{!dialogScript.isEdicion()}" />
							<p:commandButton value="#{msg['botones.aceptar']}" actionListener="#{dialogScript.aceptar()}" process="@form" update="@form growlScript"  styleClass="boton-azul" rendered="#{dialogScript.isEdicion()}" />
							<p:commandButton id="btnEliminar" value="#{msg['botones.borrar']}" icon="fa fa-trash-o" actionListener="#{dialogScript.borrar()}" process="@this" update="growlScript" styleClass="boton-rojo" rendered="#{dialogScript.isEdicion()}" >
		        				<p:confirm header="#{msg['confirm.titulo']}" message="#{msg['confirm.borradoScript']}" icon="fa fa-question-circle fa-3x confirmar_icono"/>
		        			</p:commandButton>
							<p:commandButton value="#{msg['botones.cancelar']}" actionListener="#{dialogScript.cancelar()}" process="@this"  rendered="#{dialogScript.isEdicion()}"  />
						</f:facet>
				</p:toolbar>

			<p:confirmDialog global="true" >
				<p:outputPanel styleClass="confirmar_botonera">
		        	<p:commandButton value="#{msg['botones.si']}" type="button" styleClass="ui-confirmdialog-yes boton-azul" icon="fa fa-check"  process="@form"/>
		        	<p:commandButton value="#{msg['botones.no']}" type="button" styleClass="ui-confirmdialog-no" icon="fa fa-close" process="@this"/>
				</p:outputPanel>
		    </p:confirmDialog>
	</h:form>
</h:body>

</f:view>
</html>
